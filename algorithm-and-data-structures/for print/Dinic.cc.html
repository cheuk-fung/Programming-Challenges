<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/Programming/competition/ACM/Algorithm/Dinic.cc.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v9">
<meta name="syntax" content="cpp">
<meta name="settings" content="number_lines,use_css,pre_wrap,expand_tabs">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
.lnr { color: #a52a2a; }
.Special { color: #6a5acd; }
.Type { color: #2e8b57; font-weight: bold; }
.Statement { color: #a52a2a; font-weight: bold; }
.Constant { color: #ff00ff; }
.PreProc { color: #a020f0; }
.Comment { color: #0000ff; }
-->
</style>
</head>
<body>
    <h2>Dinic</h2>
<pre>
<span class="lnr">  1 </span><span class="Comment">/*</span>
<span class="lnr">  2 </span><span class="Comment"> *  SRC: POJ 3281</span>
<span class="lnr">  3 </span><span class="Comment"> * PROB: Dining</span>
<span class="lnr">  4 </span><span class="Comment"> * ALGO: Dinic</span>
<span class="lnr">  5 </span><span class="Comment"> * DATE: Jun 2, 2011 </span>
<span class="lnr">  6 </span><span class="Comment"> * COMP: g++</span>
<span class="lnr">  7 </span><span class="Comment"> *</span>
<span class="lnr">  8 </span><span class="Comment"> * Created by Leewings Ac</span>
<span class="lnr">  9 </span><span class="Comment"> </span><span class="Comment">*/</span>
<span class="lnr"> 10 </span>
<span class="lnr"> 11 </span><span class="PreProc">#include </span><span class="Constant">&lt;cstdio&gt;</span>
<span class="lnr"> 12 </span><span class="PreProc">#include </span><span class="Constant">&lt;cstring&gt;</span>
<span class="lnr"> 13 </span><span class="PreProc">#include </span><span class="Constant">&lt;vector&gt;</span>
<span class="lnr"> 14 </span><span class="PreProc">#include </span><span class="Constant">&lt;queue&gt;</span>
<span class="lnr"> 15 </span>
<span class="lnr"> 16 </span><span class="Statement">using</span> std::vector;
<span class="lnr"> 17 </span><span class="Statement">using</span> std::queue;
<span class="lnr"> 18 </span>
<span class="lnr"> 19 </span><span class="Type">struct</span> Edge {
<span class="lnr"> 20 </span>    <span class="Type">int</span> v, p;
<span class="lnr"> 21 </span>    <span class="Type">int</span> c, f; <span class="Comment">// capa, flow</span>
<span class="lnr"> 22 </span>
<span class="lnr"> 23 </span>    Edge(<span class="Type">int</span> vv, <span class="Type">int</span> pp, <span class="Type">int</span> cc, <span class="Type">int</span> ff)
<span class="lnr"> 24 </span>        : v(vv), p(pp), c(cc), f(ff)
<span class="lnr"> 25 </span>    { }
<span class="lnr"> 26 </span>};
<span class="lnr"> 27 </span>
<span class="lnr"> 28 </span><span class="Type">const</span> <span class="Type">int</span> INF = <span class="Constant">0x7fffffff</span>;
<span class="lnr"> 29 </span><span class="Type">const</span> <span class="Type">int</span> MAXN = <span class="Constant">1000</span>;
<span class="lnr"> 30 </span><span class="Type">const</span> <span class="Type">int</span> src = <span class="Constant">0</span>, dest = MAXN;
<span class="lnr"> 31 </span>
<span class="lnr"> 32 </span>vector&lt;Edge&gt; edge[MAXN + <span class="Constant">1</span>];
<span class="lnr"> 33 </span><span class="Type">int</span> dist[MAXN + <span class="Constant">1</span>];
<span class="lnr"> 34 </span>
<span class="lnr"> 35 </span><span class="Type">inline</span> <span class="Type">int</span> min(<span class="Type">int</span> a, <span class="Type">int</span> b)
<span class="lnr"> 36 </span>{
<span class="lnr"> 37 </span>    <span class="Statement">return</span> a &lt; b ? a : b;
<span class="lnr"> 38 </span>}
<span class="lnr"> 39 </span>
<span class="lnr"> 40 </span><span class="Type">bool</span> bfs()
<span class="lnr"> 41 </span>{
<span class="lnr"> 42 </span>    memset(dist, -<span class="Constant">1</span>, <span class="Statement">sizeof</span>(dist));
<span class="lnr"> 43 </span>
<span class="lnr"> 44 </span>    queue&lt;<span class="Type">int</span>&gt; Q;
<span class="lnr"> 45 </span>    Q.push(src);
<span class="lnr"> 46 </span>    dist[src] = <span class="Constant">0</span>;
<span class="lnr"> 47 </span>
<span class="lnr"> 48 </span>    <span class="Statement">while</span>(!Q.empty()) {
<span class="lnr"> 49 </span>        <span class="Type">int</span> u = Q.front();
<span class="lnr"> 50 </span>        Q.pop();
<span class="lnr"> 51 </span>        <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; edge[u].size(); i++) {
<span class="lnr"> 52 </span>            <span class="Type">int</span> v = edge[u][i].v;
<span class="lnr"> 53 </span>            <span class="Statement">if</span> (dist[v] == -<span class="Constant">1</span> &amp;&amp; edge[u][i].f &lt; edge[u][i].c) {
<span class="lnr"> 54 </span>                dist[v] = dist[u] + <span class="Constant">1</span>;
<span class="lnr"> 55 </span>                Q.push(v);
<span class="lnr"> 56 </span>            }
<span class="lnr"> 57 </span>        }
<span class="lnr"> 58 </span>    }
<span class="lnr"> 59 </span>
<span class="lnr"> 60 </span>    <span class="Statement">return</span> dist[dest] &gt; -<span class="Constant">1</span>;
<span class="lnr"> 61 </span>}
<span class="lnr"> 62 </span>
<span class="lnr"> 63 </span><span class="Type">int</span> dfs(<span class="Type">int</span> u, <span class="Type">int</span> f)
<span class="lnr"> 64 </span>{
<span class="lnr"> 65 </span>    <span class="Statement">if</span> (u == dest) <span class="Statement">return</span> f;
<span class="lnr"> 66 </span>
<span class="lnr"> 67 </span>    <span class="Type">int</span> res = <span class="Constant">0</span>;
<span class="lnr"> 68 </span>    <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">0</span>; i &lt; edge[u].size(); i++) {
<span class="lnr"> 69 </span>        <span class="Type">int</span> v = edge[u][i].v;
<span class="lnr"> 70 </span>        <span class="Statement">if</span> (dist[v] == dist[u] + <span class="Constant">1</span> &amp;&amp; edge[u][i].f &lt; edge[u][i].c) {
<span class="lnr"> 71 </span>            <span class="Type">int</span> tmp = dfs(v, min(f - res, edge[u][i].c - edge[u][i].f));
<span class="lnr"> 72 </span>            res += tmp;
<span class="lnr"> 73 </span>            edge[u][i].f += tmp;
<span class="lnr"> 74 </span>            <span class="Type">int</span> j = edge[u][i].p;
<span class="lnr"> 75 </span>            edge[v][j].f = -edge[u][i].f;
<span class="lnr"> 76 </span>            <span class="Statement">if</span> (res == f) <span class="Statement">break</span>;
<span class="lnr"> 77 </span>        }
<span class="lnr"> 78 </span>    }
<span class="lnr"> 79 </span>
<span class="lnr"> 80 </span>    <span class="Statement">return</span> res;
<span class="lnr"> 81 </span>}
<span class="lnr"> 82 </span>
<span class="lnr"> 83 </span><span class="Type">int</span> dinic()
<span class="lnr"> 84 </span>{
<span class="lnr"> 85 </span>    <span class="Type">int</span> res = <span class="Constant">0</span>;
<span class="lnr"> 86 </span>    <span class="Statement">while</span> (bfs()) {
<span class="lnr"> 87 </span>        <span class="Type">int</span> tmp = dfs(src, MAXN);
<span class="lnr"> 88 </span>        <span class="Statement">if</span> (tmp) res += tmp;
<span class="lnr"> 89 </span>        <span class="Statement">else</span> <span class="Statement">break</span>;
<span class="lnr"> 90 </span>    }
<span class="lnr"> 91 </span>
<span class="lnr"> 92 </span>    <span class="Statement">return</span> res;
<span class="lnr"> 93 </span>}
<span class="lnr"> 94 </span>
<span class="lnr"> 95 </span><span class="Type">void</span> addEdge(<span class="Type">int</span> u, <span class="Type">int</span> v, <span class="Type">int</span> capa, <span class="Type">int</span> flow)
<span class="lnr"> 96 </span>{
<span class="lnr"> 97 </span>    edge[u].push_back(Edge(v, edge[v].size(), capa, flow));
<span class="lnr"> 98 </span>    edge[v].push_back(Edge(u, edge[u].size() - <span class="Constant">1</span>, <span class="Constant">0</span>, <span class="Constant">0</span>));
<span class="lnr"> 99 </span>}
<span class="lnr">100 </span>
<span class="lnr">101 </span><span class="Type">int</span> N, F, D;
<span class="lnr">102 </span>
<span class="lnr">103 </span><span class="Type">void</span> init()
<span class="lnr">104 </span>{
<span class="lnr">105 </span>    scanf(<span class="Constant">&quot;</span><span class="Special">%d%d%d</span><span class="Constant">&quot;</span>, &amp;N, &amp;F, &amp;D);
<span class="lnr">106 </span>
<span class="lnr">107 </span>    <span class="Comment">/*</span>
<span class="lnr">108 </span><span class="Comment">     * 0: src</span>
<span class="lnr">109 </span><span class="Comment">     * 1 to F: FF</span>
<span class="lnr">110 </span><span class="Comment">     * F + 1 to F + N: C1</span>
<span class="lnr">111 </span><span class="Comment">     * F + N + 1 to F + 2N: C2</span>
<span class="lnr">112 </span><span class="Comment">     * F + 2N + 1 to F + 2N + D: DD</span>
<span class="lnr">113 </span><span class="Comment">     * MAXN: dest</span>
<span class="lnr">114 </span><span class="Comment">     </span><span class="Comment">*/</span>
<span class="lnr">115 </span>
<span class="lnr">116 </span>    <span class="Type">const</span> <span class="Type">int</span> FF = <span class="Constant">0</span>;
<span class="lnr">117 </span>    <span class="Type">const</span> <span class="Type">int</span> C1 = F, C2 = F + N;
<span class="lnr">118 </span>    <span class="Type">const</span> <span class="Type">int</span> DD = F + <span class="Constant">2</span> * N;
<span class="lnr">119 </span>
<span class="lnr">120 </span>    <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt;= F; i++) {
<span class="lnr">121 </span>        <span class="Comment">// src -&gt; FF, capa = 1</span>
<span class="lnr">122 </span>        <span class="Comment">// FF -&gt; src, capa = 0</span>
<span class="lnr">123 </span>        addEdge(src, FF + i, <span class="Constant">1</span>, <span class="Constant">0</span>);
<span class="lnr">124 </span>    }
<span class="lnr">125 </span>    <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt;= N; i++) {
<span class="lnr">126 </span>        <span class="Comment">// C1 -&gt; C2, capa = 1</span>
<span class="lnr">127 </span>        <span class="Comment">// C2 -&gt; C1, capa = 0</span>
<span class="lnr">128 </span>        addEdge(C1 + i, C2 + i, <span class="Constant">1</span>, <span class="Constant">0</span>);
<span class="lnr">129 </span>    }
<span class="lnr">130 </span>    <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt;=D; i++) {
<span class="lnr">131 </span>        <span class="Comment">// DD -&gt; dest, capa = 1</span>
<span class="lnr">132 </span>        <span class="Comment">// dest -&gt; DD, capa = 0</span>
<span class="lnr">133 </span>        addEdge(DD + i, dest, <span class="Constant">1</span>, <span class="Constant">0</span>);
<span class="lnr">134 </span>    }
<span class="lnr">135 </span>
<span class="lnr">136 </span>    <span class="Statement">for</span> (<span class="Type">int</span> i = <span class="Constant">1</span>; i &lt;= N; i++) {
<span class="lnr">137 </span>        <span class="Type">int</span> f, d;
<span class="lnr">138 </span>        scanf(<span class="Constant">&quot;</span><span class="Special">%d%d</span><span class="Constant">&quot;</span>, &amp;f, &amp;d);
<span class="lnr">139 </span>        <span class="Statement">for</span> (<span class="Type">int</span> j = <span class="Constant">0</span>; j &lt; f; j++) {
<span class="lnr">140 </span>            <span class="Type">int</span> tmp;
<span class="lnr">141 </span>            scanf(<span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, &amp;tmp);
<span class="lnr">142 </span>            <span class="Comment">// FF -&gt; C1, capa = 1</span>
<span class="lnr">143 </span>            <span class="Comment">// C1 -&gt; FF, capa = 0</span>
<span class="lnr">144 </span>            addEdge(FF + tmp, C1 + i, <span class="Constant">1</span>, <span class="Constant">0</span>);
<span class="lnr">145 </span>        }
<span class="lnr">146 </span>        <span class="Statement">for</span> (<span class="Type">int</span> j = <span class="Constant">0</span>; j &lt; d; j++) {
<span class="lnr">147 </span>            <span class="Type">int</span> tmp;
<span class="lnr">148 </span>            scanf(<span class="Constant">&quot;</span><span class="Special">%d</span><span class="Constant">&quot;</span>, &amp;tmp);
<span class="lnr">149 </span>            <span class="Comment">// C2 -&gt; DD, capa = 1</span>
<span class="lnr">150 </span>            <span class="Comment">// DD -&gt; C2, capa = 0</span>
<span class="lnr">151 </span>            addEdge(C2 + i, DD + tmp, <span class="Constant">1</span>, <span class="Constant">0</span>);
<span class="lnr">152 </span>        }
<span class="lnr">153 </span>    }
<span class="lnr">154 </span>}
<span class="lnr">155 </span>
<span class="lnr">156 </span><span class="Type">int</span> main()
<span class="lnr">157 </span>{
<span class="lnr">158 </span>    init();
<span class="lnr">159 </span>
<span class="lnr">160 </span>    <span class="Type">int</span> ans = dinic();
<span class="lnr">161 </span>
<span class="lnr">162 </span>    printf(<span class="Constant">&quot;</span><span class="Special">%d</span><span class="Special">\n</span><span class="Constant">&quot;</span>, ans);
<span class="lnr">163 </span>
<span class="lnr">164 </span>    <span class="Statement">return</span> <span class="Constant">0</span>;
<span class="lnr">165 </span>}
<span class="lnr">166 </span>
</pre>
</body>
</html>
