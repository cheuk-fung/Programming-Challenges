<html>
<head>
<title>[Leewings] Algorithm Library</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link href="light.css" rel="stylesheet" type="text/css" />
</head>
<body id="content">
<h1>Vimrc</h1>
<div class="highlight"><pre><span class="k">set</span> <span class="nb">nocp</span> <span class="nb">backup</span> <span class="k">ru</span> <span class="nb">sc</span> <span class="k">is</span> <span class="nb">et</span> <span class="k">nu</span> <span class="nb">acd</span> <span class="nb">scs</span> <span class="k">hid</span> <span class="nb">hls</span> <span class="nb">ai</span> <span class="k">sm</span> <span class="nb">ignorecase</span> <span class="nb">sw</span><span class="p">=</span><span class="m">4</span> <span class="nb">cot</span><span class="p">=</span>longest<span class="p">,</span>menu <span class="nb">backspace</span><span class="p">=</span>indent<span class="p">,</span><span class="nb">eol</span><span class="p">,</span><span class="k">start</span> <span class="nb">mouse</span><span class="p">=</span>a
<span class="nb">syntax</span> <span class="k">on</span>
<span class="k">filetype</span> plugin indent <span class="k">on</span>
<span class="k">setlocal</span> <span class="nb">makeprg</span><span class="p">=</span>g<span class="p">++</span>\ <span class="p">-</span>g\ <span class="p">-</span>Wall\ <span class="p">-</span><span class="k">o</span>\ %:<span class="k">r</span>\ %
command <span class="p">-</span><span class="nb">bar</span> MAKE <span class="k">w</span> <span class="p">|</span> <span class="k">make</span> <span class="p">|</span> <span class="k">cw</span>
command CRUN MAKE <span class="p">|</span> <span class="p">!</span>./%:<span class="k">r</span>
command CRUNIN MAKE <span class="p">|</span> <span class="p">!</span>./%:<span class="k">r</span> <span class="p">&lt;</span> <span class="k">in</span>
command GDB <span class="p">!</span>gnome<span class="p">-</span>terminal <span class="p">-</span><span class="k">e</span> gdb %:<span class="k">r</span> &amp;

<span class="c">&quot; winsize 100 100</span>
<span class="c">&quot; winpos 600 0</span>

<span class="c">&quot; Use Vim settings, rather then Vi settings (much better!).</span>
<span class="c">&quot; This must be first, because it changes other options as a side effect.</span>
<span class="c">&quot; set nocompatible</span>

<span class="c">&quot; allow backspacing over everything in insert mode</span>
<span class="c">&quot; set backspace=indent,eol,start</span>

<span class="c">&quot; set backup		&quot; keep a backup file</span>
<span class="c">&quot; set ruler		&quot; show the cursor position all the time</span>
<span class="c">&quot; set showcmd		&quot; display incomplete commands</span>
<span class="c">&quot; set incsearch		&quot; do incremental searching</span>
<span class="c">&quot; set shiftwidth=4</span>
<span class="c">&quot; set expandtab</span>
<span class="c">&quot; set number</span>
<span class="c">&quot; set completeopt=longest,menu</span>
<span class="c">&quot; set showmatch</span>
<span class="c">&quot; set autochdir</span>
<span class="c">&quot; set ignorecase smartcase</span>
<span class="c">&quot; set hidden</span>
<span class="c">&quot; set hlsearch</span>
<span class="c">&quot; set autoindent		&quot; always set autoindenting on</span>

<span class="c">&quot; syntax on</span>
<span class="c">&quot; filetype plugin indent on</span>

<span class="c">&quot; inoremap {&lt;CR&gt;    {&lt;CR&gt;}&lt;Esc&gt;O</span>
<span class="c">&quot; vnoremap {&lt;CR&gt;   S{&lt;CR&gt;}&lt;Esc&gt;Pk=iB</span>

<span class="c">&quot; In many terminal emulators the mouse works just fine, thus enable it.</span>
<span class="c">&quot; if has(&#39;mouse&#39;)</span>
<span class="c">&quot;     set mouse=a</span>
<span class="c">&quot; endif</span>
</pre></div>
<div class="page-break"></div>
<h1>Java Template</h1>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.math.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
    <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Prob</span><span class="o">().</span><span class="na">solve</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Prob</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">MyReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyReader</span><span class="o">();</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">solve</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
    <span class="o">{</span>

        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(</span><span class="n">Object</span><span class="o">...</span><span class="na">o</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">deepToString</span><span class="o">(</span><span class="n">o</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MyReader</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
    <span class="kd">static</span> <span class="n">StringTokenizer</span> <span class="n">in</span><span class="o">;</span>

    <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">in</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">in</span><span class="o">.</span><span class="na">hasMoreTokens</span><span class="o">())</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">line</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">String</span> <span class="nf">next</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span>
    <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">in</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">in</span><span class="o">.</span><span class="na">hasMoreTokens</span><span class="o">())</span>
            <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">in</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kt">int</span> <span class="nf">nextInt</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">next</span><span class="o">());</span> <span class="o">}</span>
    <span class="kt">long</span> <span class="nf">nextLong</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">next</span><span class="o">());</span> <span class="o">}</span>
    <span class="kt">double</span> <span class="nf">nextDouble</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">next</span><span class="o">());</span> <span class="o">}</span>
    <span class="n">BigInteger</span> <span class="nf">nextBigInteger</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">BigInteger</span><span class="o">(</span><span class="n">next</span><span class="o">());</span> <span class="o">}</span>
    <span class="n">BigDecimal</span> <span class="nf">nextBigDecimal</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">BigDecimal</span><span class="o">(</span><span class="n">next</span><span class="o">());</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Usage: Arrays.sort(test, new ProbComparator());</span>
<span class="kd">class</span> <span class="nc">ProbComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Prob</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Prob</span> <span class="n">a</span><span class="o">,</span> <span class="n">Prob</span> <span class="n">b</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="c1">// return:</span>
        <span class="c1">//        1: a &gt; b</span>
        <span class="c1">//        0: a = b</span>
        <span class="c1">//       -1: a &lt; b</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<div class="page-break"></div>
<h1>Math</h1>
<h2>gcd</h2>
<div class="highlight"><pre><span class="c1">// we can use __gcd() in &lt;algorithm&gt;</span>
<span class="kt">int</span> <span class="n">gcd</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ax + by = gcd(a, b)</span>
<span class="kt">int</span> <span class="n">extended_euclid</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">extended_euclid</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="o">*</span><span class="n">x</span><span class="p">;</span>
    <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>
    <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">lcm</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Euler</h2>
<div class="highlight"><pre><span class="kt">void</span> <span class="n">euler</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">phi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prm_cnt</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">prm</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">is_prm</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">is_prm</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">prm_cnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">prm</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">prm</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">%</span> <span class="n">prm</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">prm</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                    <span class="k">else</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">prm</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>Hash</h2>
<div class="highlight"><pre><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">BKDRHash</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">131</span><span class="p">;</span> <span class="c1">// 31 131 1313 13131 131313 etc..</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="p">)</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span> <span class="o">*</span> <span class="n">seed</span> <span class="o">+</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">hash</span> <span class="o">&amp;</span> <span class="mh">0x7FFFFFFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">ELFHash</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="n">key</span><span class="o">++</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">g</span> <span class="o">=</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="mh">0xF0000000</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="n">h</span> <span class="o">^=</span> <span class="n">g</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
        <span class="n">h</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">g</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">h</span> <span class="o">%</span> <span class="n">MOD</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Count How Many Ones in Binary Notation</h2>
<div class="highlight"><pre><span class="kr">inline</span> <span class="kt">int</span> <span class="n">count_bit_one</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x55555555</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span>  <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x55555555</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span>  <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x0f0f0f0f</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span>  <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f0f0f0f</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00ff00ff</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span>  <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00ff00ff</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Prime</h2>
<div class="highlight"><pre><span class="kt">int</span> <span class="n">get_prime</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">p</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cnt</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Divisors</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2992</span>
<span class="cm"> * PROB: Divisors</span>
<span class="cm"> * ALGO: Prime</span>
<span class="cm"> * DATE: Jul 13, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>

<span class="kt">int</span> <span class="n">sum</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">cnt</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">b</span><span class="p">[</span><span class="mi">500</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">prime</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">p</span><span class="p">[</span><span class="n">sum</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">sum</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// C(n, k)</span>
<span class="kt">void</span> <span class="n">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sum</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">/=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">b</span> <span class="o">/=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">c</span> <span class="o">/=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">c</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">solve</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="n">divide</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>

    <span class="kt">long</span> <span class="kt">long</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sum</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">ans</span> <span class="o">*=</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1LL</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">prime</span><span class="p">();</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">solve</span><span class="p">())</span> <span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Josephus</h2>
<div class="highlight"><pre><span class="kt">int</span> <span class="n">josephus</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>

<span class="cm">/*</span>
<span class="cm"> * orignal:         1,         2, ... , m - 1, m, m + 1, m + 2, ... , i</span>
<span class="cm"> * relabel: i - m + 1, i - m + 2, ... , i - 1, 0,     1,     2, ... , i - m</span>
<span class="cm"> * if No.x is killed in next round,</span>
<span class="cm"> * its actually label before relabeling is (x + m - 1) % i + 1</span>
<span class="cm"> *</span>
<span class="cm"> * Hence, we get:</span>
<span class="cm"> * f[1] = 1 (the last person must be relabeled 1)</span>
<span class="cm"> * f[i] = (f[i - 1] + m - 1) % i + 1, for i in 2, 3, ... , n</span>
<span class="cm"> */</span>

    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Gauss Elimination</h2>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">GaussElimination</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">BigFraction</span><span class="o">[]</span> <span class="n">X</span><span class="o">;</span>

    <span class="c1">//  1: infinitely many solutions</span>
    <span class="c1">//  0: one solution</span>
    <span class="c1">// -1: no solution</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">solve</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="n">BigFraction</span><span class="o">[][]</span> <span class="n">A</span><span class="o">,</span> <span class="n">BigFraction</span><span class="o">[]</span> <span class="n">B</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">X</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigFraction</span><span class="o">[</span><span class="n">n</span><span class="o">];</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">xc</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">xc</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">xc</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">row</span> <span class="o">=</span> <span class="n">xc</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">xc</span><span class="o">].</span><span class="na">abs</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">xc</span><span class="o">].</span><span class="na">abs</span><span class="o">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">row</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">xc</span><span class="o">].</span><span class="na">isZero</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">B</span><span class="o">[</span><span class="n">row</span><span class="o">].</span><span class="na">isZero</span><span class="o">())</span> <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">row</span> <span class="o">!=</span> <span class="n">xc</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">xc</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">BigFraction</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">xc</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
                    <span class="n">A</span><span class="o">[</span><span class="n">xc</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">j</span><span class="o">];</span>
                    <span class="n">A</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">BigFraction</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">xc</span><span class="o">];</span>
                <span class="n">B</span><span class="o">[</span><span class="n">xc</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">row</span><span class="o">];</span>
                <span class="n">B</span><span class="o">[</span><span class="n">row</span><span class="o">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">xc</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">BigFraction</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">xc</span><span class="o">].</span><span class="na">divide</span><span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">xc</span><span class="o">][</span><span class="n">xc</span><span class="o">]);</span>
                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">xc</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                    <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span> <span class="o">=</span> <span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">].</span><span class="na">subtract</span><span class="o">(</span><span class="n">rate</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">xc</span><span class="o">][</span><span class="n">j</span><span class="o">]));</span>
                <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">subtract</span><span class="o">(</span><span class="n">rate</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">B</span><span class="o">[</span><span class="n">xc</span><span class="o">]));</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
            <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">B</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">;</span> <span class="n">j</span><span class="o">--)</span>
                <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">subtract</span><span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">].</span><span class="na">multiply</span><span class="o">(</span><span class="n">X</span><span class="o">[</span><span class="n">j</span><span class="o">]));</span>
            <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">divide</span><span class="o">(</span><span class="n">A</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span><span class="o">[]</span> <span class="nf">getAns</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">X</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">String</span> <span class="n">res</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">X</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="n">X</span><span class="o">[</span><span class="n">X</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">];</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<h2>Big Fraction</h2>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">BigFraction</span> <span class="kd">implements</span> <span class="n">Comparable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">BigInteger</span> <span class="n">numerator</span><span class="o">,</span> <span class="n">denominator</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BigFraction</span> <span class="n">ZERO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BigFraction</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">ZERO</span><span class="o">,</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BigFraction</span> <span class="n">ONE</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">BigFraction</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">,</span>  <span class="n">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">BigFraction</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">ZERO</span><span class="o">;</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">BigInteger</span> <span class="n">_numerator</span><span class="o">,</span> <span class="n">BigInteger</span> <span class="n">_denominator</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">_numerator</span><span class="o">;</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">_denominator</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">add</span><span class="o">(</span><span class="n">BigFraction</span> <span class="n">other</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">BigInteger</span> <span class="n">new_numerator</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">denominator</span><span class="o">));</span>
        <span class="n">BigInteger</span> <span class="n">new_denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">new_numerator</span><span class="o">,</span> <span class="n">new_denominator</span><span class="o">).</span><span class="na">simplify</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">subtract</span><span class="o">(</span><span class="n">BigFraction</span> <span class="n">other</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">BigInteger</span> <span class="n">new_numerator</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">).</span><span class="na">subtract</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">denominator</span><span class="o">));</span>
        <span class="n">BigInteger</span> <span class="n">new_denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">new_numerator</span><span class="o">,</span> <span class="n">new_denominator</span><span class="o">).</span><span class="na">simplify</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">multiply</span><span class="o">(</span><span class="n">BigFraction</span> <span class="n">other</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">BigInteger</span> <span class="n">new_numerator</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">numerator</span><span class="o">);</span>
        <span class="n">BigInteger</span> <span class="n">new_denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">new_numerator</span><span class="o">,</span> <span class="n">new_denominator</span><span class="o">).</span><span class="na">simplify</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">divide</span><span class="o">(</span><span class="n">BigFraction</span> <span class="n">other</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">BigInteger</span> <span class="n">new_numerator</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">denominator</span><span class="o">);</span>
        <span class="n">BigInteger</span> <span class="n">new_denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">.</span><span class="na">numerator</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">new_numerator</span><span class="o">,</span> <span class="n">new_denominator</span><span class="o">).</span><span class="na">simplify</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">abs</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">numerator</span><span class="o">.</span><span class="na">abs</span><span class="o">(),</span> <span class="n">denominator</span><span class="o">.</span><span class="na">abs</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Object</span> <span class="n">other</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="nf">subtract</span><span class="o">((</span><span class="n">BigFraction</span><span class="o">)</span><span class="n">other</span><span class="o">).</span><span class="na">signum</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isZero</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">numerator</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">ZERO</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isInteger</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">denominator</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">negate</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">numerator</span><span class="o">.</span><span class="na">negate</span><span class="o">(),</span> <span class="n">denominator</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">signum</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">numerator</span><span class="o">.</span><span class="na">signum</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">BigFraction</span> <span class="nf">simplify</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isZero</span><span class="o">())</span> <span class="k">return</span> <span class="n">BigFraction</span><span class="o">.</span><span class="na">ZERO</span><span class="o">;</span>
        <span class="n">BigInteger</span> <span class="n">gcd</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">.</span><span class="na">gcd</span><span class="o">(</span><span class="n">denominator</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">denominator</span><span class="o">.</span><span class="na">signum</span><span class="o">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">numerator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">gcd</span><span class="o">).</span><span class="na">negate</span><span class="o">(),</span>
                    <span class="n">denominator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">gcd</span><span class="o">).</span><span class="na">negate</span><span class="o">());</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BigFraction</span><span class="o">(</span><span class="n">numerator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">gcd</span><span class="o">),</span> <span class="n">denominator</span><span class="o">.</span><span class="na">divide</span><span class="o">(</span><span class="n">gcd</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isZero</span><span class="o">())</span> <span class="k">return</span> <span class="s">&quot;0&quot;</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isInteger</span><span class="o">())</span> <span class="k">return</span> <span class="n">numerator</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">denominator</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<div class="page-break"></div>
<h1>String</h1>
<h2>Trie Tree</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3630</span>
<span class="cm"> * PROB: Phone List</span>
<span class="cm"> * ALGO: Trie</span>
<span class="cm"> * DATE: Jul 22, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstdlib&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>

<span class="k">class</span> <span class="nc">Trie</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">CHARSET_SIZE</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">NODE_MAX_SIZE</span> <span class="o">=</span> <span class="mi">200000</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">next</span><span class="p">[</span><span class="n">CHARSET_SIZE</span><span class="p">];</span>
            <span class="kt">int</span> <span class="n">exist</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="n">NODE_MAX_SIZE</span><span class="p">],</span>
              <span class="o">*</span><span class="n">node_tail</span><span class="p">,</span>
              <span class="o">*</span><span class="n">root</span><span class="p">;</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Trie</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">reset</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">node</span><span class="p">));</span>
            <span class="n">node_tail</span> <span class="o">=</span> <span class="n">node</span><span class="p">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">node_tail</span><span class="o">++</span><span class="p">;</span>
            <span class="n">root</span><span class="o">-&gt;</span><span class="n">exist</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">insert</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="o">++</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tail</span><span class="o">++</span><span class="p">;</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">exist</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">p</span><span class="o">-&gt;</span><span class="n">exist</span><span class="o">++</span><span class="p">;</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">Trie</span> <span class="n">trie</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">phone</span><span class="p">[</span><span class="mi">10000</span><span class="p">][</span><span class="mi">20</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">cmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">strcmp</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">work</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">trie</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>

    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">phone</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="n">qsort</span><span class="p">(</span><span class="n">phone</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cmp</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">trie</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">phone</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">&quot;NO&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">;</span>
        <span class="p">}</span>

    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;YES&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">t</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">t</span><span class="o">--</span><span class="p">)</span> <span class="n">work</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>KMP</h2>
<div class="highlight"><pre><span class="kt">void</span> <span class="n">kmp_init</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">prn</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">prn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="n">prn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">kmp</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">prn</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIterator</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">kmp_init</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">prn</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">prn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">ForwardIterator</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">curr</span> <span class="o">!=</span> <span class="n">last</span><span class="p">;</span> <span class="n">curr</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="o">*</span><span class="n">curr</span><span class="p">)</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="n">curr</span><span class="p">)</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="n">prn</span><span class="p">[</span><span class="n">curr</span> <span class="o">-</span> <span class="n">first</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIterator</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">kmp_init</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">prn</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">prn</span><span class="o">-&gt;</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">prn</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">ForwardIterator</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">curr</span> <span class="o">!=</span> <span class="n">last</span><span class="p">;</span> <span class="n">curr</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="o">*</span><span class="n">curr</span><span class="p">)</span> <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">prn</span><span class="p">)[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="n">curr</span><span class="p">)</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="n">prn</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIterator</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Pattern</span><span class="o">&gt;</span>
<span class="kt">int</span> <span class="n">kmp</span><span class="p">(</span><span class="k">const</span> <span class="n">Pattern</span> <span class="o">&amp;</span><span class="n">prn</span><span class="p">,</span>                                                  \
        <span class="n">ForwardIterator</span> <span class="n">first_a</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last_a</span><span class="p">,</span>                     \
        <span class="n">ForwardIterator</span> <span class="n">first_b</span><span class="p">,</span> <span class="n">ForwardIterator</span> <span class="n">last_b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">ForwardIterator</span> <span class="n">curr_a</span> <span class="o">=</span> <span class="n">first_a</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">curr_a</span> <span class="o">!=</span> <span class="n">last_a</span><span class="p">;</span> <span class="n">curr_a</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">first_b</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="o">*</span><span class="n">curr_a</span><span class="p">)</span> <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first_b</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="n">curr_a</span><span class="p">)</span> <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">first_b</span> <span class="o">+</span> <span class="n">j</span> <span class="o">==</span> <span class="n">last_b</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">prn</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>AC Automata</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1204</span>
<span class="cm"> * PROB: Word Puzzles</span>
<span class="cm"> * ALGO: AC Automata</span>
<span class="cm"> * DATE: Jul 23, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ans_cnt</span><span class="p">,</span> <span class="n">len</span><span class="p">[</span><span class="mi">1010</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">map</span><span class="p">[</span><span class="mi">1010</span><span class="p">][</span><span class="mi">1010</span><span class="p">],</span> <span class="n">word</span><span class="p">[</span><span class="mi">1010</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Answers</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">dir</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1010</span><span class="p">];</span>

<span class="k">class</span> <span class="nc">ACAutomata</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">CHARSET_SIZE</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">NODE_MAX_SIZE</span> <span class="o">=</span> <span class="mi">200000</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">next</span><span class="p">[</span><span class="n">CHARSET_SIZE</span><span class="p">];</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">fail</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">exist</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="n">NODE_MAX_SIZE</span><span class="p">],</span>
              <span class="o">*</span><span class="n">node_tail</span><span class="p">,</span>
              <span class="o">*</span><span class="n">root</span><span class="p">;</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">ACAutomata</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">node</span><span class="p">));</span>
            <span class="n">node_tail</span> <span class="o">=</span> <span class="n">node</span><span class="p">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">node_tail</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">insert</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="o">++</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tail</span><span class="o">++</span><span class="p">;</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
            <span class="p">}</span>

            <span class="n">p</span><span class="o">-&gt;</span><span class="n">exist</span><span class="o">++</span><span class="p">;</span>
            <span class="n">p</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">build_fail</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">queue</span><span class="o">&lt;</span><span class="n">Tnode</span> <span class="o">*&gt;</span> <span class="n">Q</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CHARSET_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">fail</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
                    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">Tnode</span> <span class="o">*</span><span class="n">curr</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
                <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CHARSET_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Tnode</span> <span class="o">*</span><span class="n">u</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">Tnode</span> <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                        <span class="n">u</span><span class="o">-&gt;</span><span class="n">fail</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

                        <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// for nesting case</span>
                <span class="c1">// if (!curr-&gt;id) curr-&gt;id = curr-&gt;fail-&gt;id;</span>
            <span class="p">}</span>
        <span class="p">}</span>

<span class="c1">//        int query(char* s)</span>
        <span class="kt">void</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dy</span><span class="p">,</span> <span class="kt">char</span> <span class="n">dir</span><span class="p">)</span>
        <span class="p">{</span>
<span class="c1">//            int res = 0;</span>

            <span class="n">Tnode</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">])</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">root</span><span class="p">)</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Tnode</span><span class="o">*</span> <span class="n">t</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="n">root</span> <span class="o">&amp;&amp;</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">ans_cnt</span><span class="o">++</span><span class="p">;</span>
                            <span class="n">ans</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">len</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">;</span>
                            <span class="n">ans</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">].</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">len</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span><span class="p">;</span>
                            <span class="n">ans</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">].</span><span class="n">dir</span> <span class="o">=</span> <span class="n">dir</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span><span class="p">;</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="n">dy</span><span class="p">;</span>
            <span class="p">}</span>

<span class="c1">//            return res;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">ACAutomata</span> <span class="n">aca</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">word</span><span class="p">);</span>
        <span class="n">aca</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">len</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">aca</span><span class="p">.</span><span class="n">build_fail</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;B&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;D&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;E&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;F&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;H&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;B&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;C&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;D&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;F&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;G&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;H&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans_cnt</span> <span class="o">==</span> <span class="n">w</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dir</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>DP on AC Automata</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: ZOJ 3545</span>
<span class="cm"> * PROB: Rescue the Rabbit</span>
<span class="cm"> * ALGO: DP on AC Automata</span>
<span class="cm"> * DATE: Oct 05, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">w</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">dna</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="mi">200</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">gene_to_id</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">&#39;A&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;G&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;T&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;C&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ACAutomata</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">CHARSET_SIZE</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">NODE_MAX_SIZE</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="n">Tnode</span><span class="o">*</span> <span class="n">next</span><span class="p">[</span><span class="n">CHARSET_SIZE</span><span class="p">];</span>
            <span class="n">Tnode</span><span class="o">*</span> <span class="n">fail</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">Tnode</span><span class="o">*</span> <span class="n">root</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">node_cnt</span><span class="p">;</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="n">NODE_MAX_SIZE</span><span class="p">];</span>

        <span class="kt">int</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1024</span><span class="p">][</span><span class="mi">1024</span><span class="p">];</span>
        <span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1024</span><span class="p">][</span><span class="mi">1024</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">curr</span><span class="p">,</span> <span class="n">next</span><span class="p">;</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">ACAutomata</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">node</span><span class="p">));</span>
            <span class="n">node_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">node</span><span class="p">[</span><span class="n">node_cnt</span><span class="o">++</span><span class="p">];</span>

            <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
            <span class="n">curr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">next</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">insert</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">gene_to_id</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">node</span><span class="p">[</span><span class="n">node_cnt</span><span class="o">++</span><span class="p">];</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
                <span class="n">s</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">p</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">build_fail</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">queue</span><span class="o">&lt;</span><span class="n">Tnode</span><span class="o">*&gt;</span> <span class="n">Q</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CHARSET_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">fail</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
                    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">Tnode</span><span class="o">*</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
                <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>

                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CHARSET_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Tnode</span><span class="o">*</span> <span class="n">u</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">Tnode</span><span class="o">*</span> <span class="n">v</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                        <span class="n">u</span><span class="o">-&gt;</span><span class="n">fail</span> <span class="o">=</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

                        <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// for nesting case</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">curr</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">curr</span><span class="o">-&gt;</span><span class="n">fail</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">query</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mh">0xafafafaf</span><span class="p">;</span>

            <span class="n">f</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">vis</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">node_cnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">final</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">CHARSET_SIZE</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                                <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">node</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                                <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">root</span><span class="p">)</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

                                <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span>
                                    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                                <span class="n">Tnode</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
                                <span class="k">while</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="kt">int</span> <span class="n">t_state</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="n">t_state</span><span class="p">))</span> <span class="p">{</span>
                                        <span class="n">offset</span> <span class="o">+=</span> <span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">];</span>
                                        <span class="n">state</span> <span class="o">|=</span> <span class="n">t_state</span><span class="p">;</span>
                                    <span class="p">}</span>
                                    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">-&gt;</span><span class="n">fail</span><span class="p">;</span>
                                <span class="p">}</span>

                                <span class="n">vis</span><span class="p">[</span><span class="n">next</span><span class="p">][</span><span class="n">p</span> <span class="o">-</span> <span class="n">node</span><span class="p">][</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                                <span class="n">f</span><span class="p">[</span><span class="n">next</span><span class="p">][</span><span class="n">p</span> <span class="o">-</span> <span class="n">node</span><span class="p">][</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">next</span><span class="p">][</span><span class="n">p</span> <span class="o">-</span> <span class="n">node</span><span class="p">][</span><span class="n">state</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">curr</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>
                                <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">next</span><span class="p">][</span><span class="n">p</span> <span class="o">-</span> <span class="n">node</span><span class="p">][</span><span class="n">state</span><span class="p">]);</span>
                            <span class="p">}</span>
                <span class="n">curr</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">next</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">next</span><span class="p">],</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">next</span><span class="p">]));</span>
                <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">next</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">next</span><span class="p">]));</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">ans</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;No Rabbit after 2012!&quot;</span><span class="p">);</span>
            <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">ACAutomata</span> <span class="n">aca</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s%d&quot;</span><span class="p">,</span> <span class="n">dna</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
            <span class="n">aca</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">aca</span><span class="p">.</span><span class="n">build_fail</span><span class="p">();</span>
        <span class="n">aca</span><span class="p">.</span><span class="n">query</span><span class="p">();</span>
        <span class="n">aca</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Suffix Array</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3882</span>
<span class="cm"> * PROB: Stammering Aliens</span>
<span class="cm"> * ALGO: Suffix Array</span>
<span class="cm"> * DATE: Aug 21, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;utility&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Suffix_Array</span> <span class="p">{</span>
    <span class="c1">// use Doubling Algorithm</span>

    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">MAX_LEN</span> <span class="o">=</span> <span class="mi">40010</span><span class="p">;</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">MAX_CHAR</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>

        <span class="kt">int</span><span class="o">*</span> <span class="n">n_rank</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">int_buf_1</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">],</span> <span class="n">int_buf_2</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span> <span class="c1">// used for ranking</span>

        <span class="kt">int</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span> <span class="c1">// used for counting sort</span>

        <span class="kt">void</span> <span class="n">c_sort</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">range</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span><span class="o">*</span> <span class="n">t_rank</span> <span class="o">=</span> <span class="n">n_rank</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">tR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">len</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">t_rank</span><span class="p">[</span><span class="n">tR</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span> <span class="n">t_rank</span><span class="p">[</span><span class="n">tR</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">cnt</span><span class="p">[</span><span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">range</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">t_rank</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">suff</span><span class="p">[</span><span class="o">--</span><span class="n">cnt</span><span class="p">[</span><span class="n">rank</span><span class="p">[</span><span class="n">j</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">range</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">suff</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span> <span class="c1">// suff[i]: the i-th *sorted* suffix</span>
        <span class="kt">int</span><span class="o">*</span> <span class="n">rank</span><span class="p">;</span>         <span class="c1">// rank[i]: the rank of the i-th *original* suffix</span>
        <span class="c1">// suff[i] = j &lt;=&gt; rank[j] = i</span>

        <span class="c1">// LCP(i, j): the Longest Common Prefix of the i-th and j-th *sorted* suffixes</span>
        <span class="kt">int</span> <span class="n">hgt</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>  <span class="c1">//  hgt[i]: LCP(i - 1, i)</span>

        <span class="kt">int</span> <span class="n">max_suff</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAX_LEN</span><span class="p">],</span> <span class="n">min_hgt</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAX_LEN</span><span class="p">];</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">int_buf_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">int_buf_1</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">int_buf_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">int_buf_2</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">suff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">suff</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">hgt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">hgt</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">build</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">int_buf_1</span><span class="p">;</span>
            <span class="n">n_rank</span> <span class="o">=</span> <span class="n">int_buf_2</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">c_sort</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX_CHAR</span><span class="p">);</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_rank</span> <span class="o">=</span> <span class="n">MAX_CHAR</span><span class="p">;</span> <span class="n">max_rank</span> <span class="o">!=</span> <span class="n">len</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">c_sort</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">max_rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

                <span class="n">max_rank</span> <span class="o">=</span> <span class="n">n_rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="n">rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="n">rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">])</span>
                        <span class="n">n_rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">max_rank</span><span class="p">;</span>
                    <span class="k">else</span> <span class="n">n_rank</span><span class="p">[</span><span class="n">suff</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="o">++</span><span class="n">max_rank</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kt">int</span><span class="o">*</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">rank</span><span class="p">;</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="n">n_rank</span><span class="p">;</span>
                <span class="n">n_rank</span> <span class="o">=</span> <span class="n">tp</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">calc_hgt</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">hgt</span><span class="p">[</span><span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]]</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">?</span> <span class="n">k</span><span class="o">--</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">suff</span><span class="p">[</span><span class="n">rank</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span> <span class="n">str</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">str</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="p">];</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">calc_lcp</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">max_suff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">suff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">len</span><span class="p">);</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">min_hgt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hgt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">len</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">len</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">max_suff</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">max_suff</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">max_suff</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
                    <span class="n">min_hgt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">min_hgt</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">min_hgt</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
                <span class="p">}</span>

        <span class="p">}</span>

        <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">lcp</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// [l, r)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">max_suff</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">max_suff</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">)]);</span>

            <span class="n">l</span><span class="o">++</span><span class="p">;</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">min_hgt</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">min_hgt</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">)]);</span>

            <span class="k">return</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">Suffix_Array</span> <span class="n">sa</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">.</span><span class="n">str</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sa</span><span class="p">.</span><span class="n">str</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">sa</span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
        <span class="n">sa</span><span class="p">.</span><span class="n">calc_hgt</span><span class="p">();</span>
        <span class="n">sa</span><span class="p">.</span><span class="n">calc_lcp</span><span class="p">();</span>

        <span class="kt">int</span> <span class="n">longest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">sa</span><span class="p">.</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">sa</span><span class="p">.</span><span class="n">lcp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">m</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">&gt;</span> <span class="n">longest</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">longest</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">longest</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">)</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">longest</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">longest</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;none&quot;</span><span class="p">);</span>

        <span class="n">sa</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="page-break"></div>
<h1>Computational Geometry</h1>
<h2>Common</h2>
<div class="highlight"><pre><span class="c1">// Constants</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">DINF</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">0.0f</span><span class="p">;</span>

<span class="c1">// Functions</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq0</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">ls</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">gr</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">greq</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">lseq</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">double</span> <span class="n">fmax</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">gr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">?</span> <span class="n">x</span> <span class="o">:</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">double</span> <span class="n">fmin</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">?</span> <span class="n">x</span> <span class="o">:</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">double</span> <span class="n">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="p">}</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="n">Vec</span> <span class="n">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">Vec</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
               <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
               <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<h2>Distance from Point to Segment</h2>
<div class="highlight"><pre><span class="kr">inline</span> <span class="kt">double</span> <span class="n">dist_p2seg</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ls</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">))</span> <span class="k">return</span> <span class="n">dist</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ls</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">))</span> <span class="k">return</span> <span class="n">dist</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">area</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eq0</span><span class="p">(</span><span class="n">area</span><span class="p">))</span> <span class="k">return</span> <span class="n">fmin</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">dist</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">area</span> <span class="o">/</span> <span class="n">dist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<h2>Gravity Center</h2>
<div class="highlight"><pre><span class="c1">// ver[] has been sorted by clockwise or counterclockwise</span>
<span class="n">Point</span> <span class="n">g_center</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">ver</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Point</span> <span class="n">res</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">ver</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="kt">double</span> <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
              <span class="o">&amp;</span><span class="n">b</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
        <span class="n">area</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
        <span class="n">res</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>
        <span class="n">res</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">res</span><span class="p">.</span><span class="n">x</span> <span class="o">/=</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">area</span><span class="p">);</span>
    <span class="n">res</span><span class="p">.</span><span class="n">y</span> <span class="o">/=</span> <span class="p">(</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">area</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Graham Scan</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1113</span>
<span class="cm"> * PROB: Wall</span>
<span class="cm"> * ALGO: Graham Scan(Convex Hull)</span>
<span class="cm"> * DATE: Jul 26, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq0</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">ls</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">gr</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">agl</span><span class="p">;</span>

    <span class="n">Point</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">Point</span><span class="p">(</span><span class="kt">double</span> <span class="n">_x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">_y</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">_x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Point</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">sqlen</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">double</span> <span class="n">length</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqlen</span><span class="p">());</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">Point</span> <span class="n">Vec</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Point</span> <span class="n">first_ver</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">agl</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">agl</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ls</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">first_ver</span><span class="p">).</span><span class="n">sqlen</span><span class="p">(),</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">first_ver</span><span class="p">).</span><span class="n">sqlen</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">agl</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">agl</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">check</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">graham_scan</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">ver</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">stack</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">top</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">min_ver</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ver</span><span class="p">[</span><span class="n">min_ver</span><span class="p">])</span> <span class="n">min_ver</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">min_ver</span><span class="p">]);</span>
    <span class="n">first_ver</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">agl</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">y</span><span class="p">,</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">ver</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ver</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">cmp</span><span class="p">);</span>

    <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">top</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">top</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">top</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
            <span class="n">top</span><span class="o">--</span><span class="p">;</span>
        <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="kt">double</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">top</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">stack</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]).</span><span class="n">length</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Point</span> <span class="n">ver</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">top</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lf%lf&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%.0f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">graham_scan</span><span class="p">(</span><span class="n">ver</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">l</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>3d Convex Hull</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: HDOJ 3662</span>
<span class="cm"> * PROB: 3D Convex Hull</span>
<span class="cm"> * ALGO: 3D Convex Hull</span>
<span class="cm"> * DATE: Nov 12, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span> <span class="o">=</span> <span class="mi">333</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq0</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">gr</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>

    <span class="n">Point</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">Point</span><span class="p">(</span><span class="kt">double</span> <span class="n">_x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">_y</span><span class="p">,</span> <span class="kt">double</span> <span class="n">_z</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">_x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">_y</span><span class="p">),</span> <span class="n">z</span><span class="p">(</span><span class="n">_z</span><span class="p">),</span> <span class="n">id</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>

    <span class="n">Point</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">sqlen</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">double</span> <span class="n">len</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqlen</span><span class="p">());</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="n">norm</span><span class="p">()</span> <span class="p">{</span> <span class="kt">double</span> <span class="n">l</span> <span class="o">=</span> <span class="n">len</span><span class="p">();</span> <span class="n">x</span> <span class="o">/=</span> <span class="n">l</span><span class="p">;</span> <span class="n">y</span> <span class="o">/=</span> <span class="n">l</span><span class="p">;</span> <span class="n">z</span> <span class="o">/=</span> <span class="n">l</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">Point</span> <span class="n">Vec</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="n">Vec</span> <span class="n">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">Vec</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
               <span class="n">u</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span><span class="p">,</span>
               <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">coline</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">eq0</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">).</span><span class="n">sqlen</span><span class="p">());</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">coplaner</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">eq0</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">d</span> <span class="o">-</span> <span class="n">a</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Plane</span> <span class="p">{</span>
    <span class="n">Point</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">;</span>

    <span class="n">Plane</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">Plane</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">_p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">_p1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">_p2</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">p0</span><span class="p">(</span><span class="n">_p0</span><span class="p">),</span> <span class="n">p1</span><span class="p">(</span><span class="n">_p1</span><span class="p">),</span> <span class="n">p2</span><span class="p">(</span><span class="n">_p2</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>

    <span class="n">Vec</span> <span class="n">norm_vec</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">Vec</span> <span class="n">n</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p0</span><span class="p">);</span>
        <span class="n">n</span><span class="p">.</span><span class="n">norm</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">coplaner</span><span class="p">(</span><span class="k">const</span> <span class="n">Plane</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Plane</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">coplaner</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> \
           <span class="n">coplaner</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> \
           <span class="n">coplaner</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">p2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">point_above_plane</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Plane</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">gr</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">norm_vec</span><span class="p">()),</span> <span class="mf">0.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXV</span><span class="p">][</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Plane</span> <span class="n">tf</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">convex_hull</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">ver</span><span class="p">,</span> <span class="n">Plane</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ch_cnt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">edge</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">coline</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">coline</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">swap</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">coplaner</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">coplaner</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">swap</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plane</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plane</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Point</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Plane</span> <span class="n">f</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">point_above_plane</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">tf_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Plane</span> <span class="n">f</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">tf</span><span class="p">[</span><span class="n">tf_cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plane</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">curr</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">tf</span><span class="p">[</span><span class="n">tf_cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plane</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">curr</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">.</span><span class="n">id</span><span class="p">][</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">tf</span><span class="p">[</span><span class="n">tf_cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plane</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="n">p0</span><span class="p">,</span> <span class="n">curr</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="n">tf</span><span class="p">[</span><span class="n">tf_cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tf_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">tf_cnt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">*</span><span class="n">ch_cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">cnt_plane</span><span class="p">(</span><span class="k">const</span> <span class="n">Plane</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ch_cnt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">plane_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ch_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">coplaner</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ch</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="n">plane_cnt</span> <span class="o">+=</span> <span class="n">unique</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">plane_cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">surface_area</span><span class="p">(</span><span class="k">const</span> <span class="n">Plane</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ch_cnt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ch_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cross</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p1</span> <span class="o">-</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p0</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p2</span> <span class="o">-</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p0</span><span class="p">).</span><span class="n">len</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">volume</span><span class="p">(</span><span class="k">const</span> <span class="n">Plane</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ch_cnt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">v</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">Point</span> <span class="n">O</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ch_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p0</span> <span class="o">-</span> <span class="n">O</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p1</span> <span class="o">-</span> <span class="n">O</span><span class="p">),</span> <span class="n">ch</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p2</span> <span class="o">-</span> <span class="n">O</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Point</span> <span class="n">ver</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Plane</span> <span class="n">ch</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span> <span class="c1">// convex hull, actually, it stores *triangles*</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">ch_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lf%lf%lf&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">z</span><span class="p">);</span>
            <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">convex_hull</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ver</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ch_cnt</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt_plane</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">ch_cnt</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Rotating Calipers</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2187</span>
<span class="cm"> * PROB: Beauty Contest</span>
<span class="cm"> * ALGO: Rotating Calipers</span>
<span class="cm"> * DATE: Nov 09, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">50010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq0</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">ls</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">gr</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">double</span> <span class="n">fmax</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">gr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">?</span> <span class="n">x</span> <span class="o">:</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">agl</span><span class="p">;</span>

    <span class="n">Point</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">Point</span><span class="p">(</span><span class="kt">double</span> <span class="n">_x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">_y</span><span class="p">)</span> <span class="o">:</span> <span class="n">x</span><span class="p">(</span><span class="n">_x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Point</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">sqlen</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">double</span> <span class="n">length</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqlen</span><span class="p">());</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">Point</span> <span class="n">Vec</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">double</span> <span class="n">dist</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">).</span><span class="n">length</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">Point</span> <span class="n">first_ver</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">agl</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">agl</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ls</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">first_ver</span><span class="p">).</span><span class="n">sqlen</span><span class="p">(),</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">first_ver</span><span class="p">).</span><span class="n">sqlen</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">agl</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">agl</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">check</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">graham_scan</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">ver</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">stack</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">top</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">min_ver</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ver</span><span class="p">[</span><span class="n">min_ver</span><span class="p">])</span> <span class="n">min_ver</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">min_ver</span><span class="p">]);</span>
    <span class="n">first_ver</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">agl</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">y</span><span class="p">,</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">ver</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ver</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">cmp</span><span class="p">);</span>

    <span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">top</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">top</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">top</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
            <span class="n">top</span><span class="o">--</span><span class="p">;</span>
        <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">top</span><span class="p">]</span> <span class="o">=</span> <span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">rotating_calipers</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">*</span><span class="n">ver</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">curr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">next</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">curr</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">curr</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">gr</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">curr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="n">curr</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">next</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="n">curr</span><span class="p">]),</span>
                  <span class="n">cross</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">curr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="n">curr</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">next</span><span class="p">]</span> <span class="o">-</span> <span class="n">ver</span><span class="p">[</span><span class="n">curr</span><span class="p">])))</span>
            <span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">next</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">fmax</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dist</span><span class="p">(</span><span class="n">ver</span><span class="p">[</span><span class="n">curr</span><span class="p">],</span> <span class="n">ver</span><span class="p">[</span><span class="n">next</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Point</span> <span class="n">ver</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">top</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lf%lf&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ver</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>

    <span class="n">graham_scan</span><span class="p">(</span><span class="n">ver</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">top</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">rotating_calipers</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span> <span class="n">top</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%.0f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span> <span class="o">*</span> <span class="n">ans</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Cutting Rectangle</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">ID: os.idea1</span>
<span class="cm">LANG: C</span>
<span class="cm">TASK: window</span>
<span class="cm">*/</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="cp">#define MAX_SIZE 1000</span>

<span class="n">FILE</span> <span class="o">*</span><span class="n">fin</span><span class="p">,</span> <span class="o">*</span><span class="n">fout</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Lnode</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">pos</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Point</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">prev</span><span class="p">,</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span> <span class="n">link</span><span class="p">[</span><span class="n">MAX_SIZE</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">head</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">link_cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">pos</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Rectangle</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">Point</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">del</span><span class="p">;</span>
<span class="p">}</span> <span class="n">rec</span><span class="p">[</span><span class="n">MAX_SIZE</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">rec_cnt</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">area</span><span class="p">(</span><span class="k">struct</span> <span class="n">Point</span> <span class="n">a</span><span class="p">,</span> <span class="k">struct</span> <span class="n">Point</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">rec_insert</span><span class="p">(</span><span class="k">struct</span> <span class="n">Point</span> <span class="n">a</span><span class="p">,</span> <span class="k">struct</span> <span class="n">Point</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rec</span><span class="p">[</span><span class="n">rec_cnt</span><span class="p">].</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">rec</span><span class="p">[</span><span class="n">rec_cnt</span><span class="p">].</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">rec</span><span class="p">[</span><span class="n">rec_cnt</span><span class="p">].</span><span class="n">del</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">rec_cnt</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">min</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">max</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="n">create</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">[</span><span class="n">link_cnt</span><span class="o">++</span><span class="p">];</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">pos</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">;</span>

    <span class="n">sscanf</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;%d%*c%d%*c%d%*c%d&quot;</span><span class="p">,</span>
           <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="k">else</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">destory</span><span class="p">(</span><span class="kt">char</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">id</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">==</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">==</span> <span class="n">tail</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tail</span><span class="p">)</span> <span class="n">tail</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>

    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">to_top</span><span class="p">(</span><span class="kt">char</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">id</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">==</span> <span class="n">head</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>

    <span class="n">destory</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">to_bottom</span><span class="p">(</span><span class="kt">char</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">id</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">==</span> <span class="n">tail</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>

    <span class="n">destory</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">tail</span><span class="p">;</span>
    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tail</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
    <span class="n">tail</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">show</span><span class="p">(</span><span class="kt">char</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rec_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">rec_insert</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">id</span><span class="p">]].</span><span class="n">a</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">id</span><span class="p">]].</span><span class="n">b</span><span class="p">);</span>

    <span class="k">struct</span> <span class="n">Lnode</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rec_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">del</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">||</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">||</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

                <span class="kt">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">x2</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">x1</span><span class="p">)</span>
                    <span class="n">rec_insert</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x1</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">x2</span><span class="p">)</span>
                    <span class="n">rec_insert</span><span class="p">((</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x2</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">},</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">),</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">y1</span><span class="p">)</span>
                    <span class="n">rec_insert</span><span class="p">((</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x1</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">},</span> \
                               <span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">)</span>
                    <span class="n">rec_insert</span><span class="p">((</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x1</span><span class="p">,</span> <span class="n">y2</span><span class="p">},</span> \
                               <span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="p">){</span><span class="n">x2</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">});</span>

                <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">del</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="n">ptr</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">area_sum</span> <span class="o">=</span> <span class="n">area</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">a</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">b</span><span class="p">),</span> <span class="n">area_rest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rec_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">del</span><span class="p">)</span> <span class="n">area_rest</span> <span class="o">+=</span> <span class="n">area</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a</span><span class="p">,</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">);</span>

    <span class="n">fprintf</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="s">&quot;%.3f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">area_rest</span> <span class="o">/</span> <span class="n">area_sum</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">link</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">fin</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;window.in&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="n">fout</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;window.out&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>

    <span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">fscanf</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">case</span> <span class="sc">&#39;w&#39;</span><span class="o">:</span> <span class="n">create</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>       <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;t&#39;</span><span class="o">:</span> <span class="n">to_top</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>    <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;b&#39;</span><span class="o">:</span> <span class="n">to_bottom</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;d&#39;</span><span class="o">:</span> <span class="n">destory</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>   <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;s&#39;</span><span class="o">:</span> <span class="n">show</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Cloest Pair of Points on Plane</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: NKOJ 2185</span>
<span class="cm"> * PROB: Exercise 5</span>
<span class="cm"> * ALGO: D&amp;C</span>
<span class="cm"> * DATE: Nov 23, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;cstdlib&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_P</span> <span class="o">=</span> <span class="mi">30010</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Point</span> <span class="n">X</span><span class="p">[</span><span class="n">MAX_P</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">MAX_P</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="n">MAX_P</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp_x</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp_y</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">sqr</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Point</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">sqr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sqr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">merge</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="n">left</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">left</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">mid</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">y</span><span class="p">)</span> <span class="n">p</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">l</span><span class="o">++</span><span class="p">];</span>
        <span class="k">else</span> <span class="n">p</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">r</span><span class="o">++</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span>   <span class="n">p</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">l</span><span class="o">++</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">right</span><span class="p">)</span> <span class="n">p</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">r</span><span class="o">++</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">closest</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">Y</span><span class="p">,</span> <span class="n">Point</span> <span class="o">*</span><span class="n">Z</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// X[l, r]</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">]),</span>
            <span class="n">d3</span> <span class="o">=</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span> <span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">else</span> <span class="n">Z</span><span class="p">[</span><span class="n">k</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">dl</span> <span class="o">=</span> <span class="n">closest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">),</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">closest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>
        <span class="n">d</span>  <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">dl</span><span class="p">,</span> <span class="n">dr</span><span class="p">);</span>
    <span class="n">merge</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">z_cnt</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sqr</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">mid</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">Z</span><span class="p">[</span><span class="n">z_cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">z_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">z_cnt</span> <span class="o">&amp;&amp;</span> <span class="n">sqr</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sqr_dist</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">]));</span>

    <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">closest_pair</span><span class="p">(</span><span class="n">Point</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">cmp_x</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">cmp_y</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">closest</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">closest_pair</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="page-break"></div>
<h1>Graph Theory</h1>
<h2>Prim</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1258</span>
<span class="cm"> * PROB: Agri-Net</span>
<span class="cm"> * ALGO: Prim</span>
<span class="cm"> * DATE: Jul 24, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>

    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_d</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">bool</span> <span class="n">prim</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="n">EOF</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">d</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">)</span> <span class="n">edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">));</span>
        <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">Q</span><span class="p">;</span>
    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">v</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">td</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">d</span><span class="p">;</span> 
        <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">u</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">td</span><span class="p">;</span>
        <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">d</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
                <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">prim</span><span class="p">())</span> <span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Kruskal</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1258</span>
<span class="cm"> * PROB: Agri-Net</span>
<span class="cm"> * ALGO: Kruskal + Disjoint Set</span>
<span class="cm"> * DATE: Jul 24, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">110</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXM</span> <span class="o">=</span> <span class="mi">10010</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">d</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span> <span class="n">e</span><span class="p">[</span><span class="n">MAXM</span><span class="p">];</span>

<span class="k">class</span> <span class="nc">Disjoint_Set</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="n">Disjoint_Set</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span> <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="p">}</span>

        <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">join</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>
<span class="n">Disjoint_Set</span> <span class="n">ds</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">kruskal</span><span class="p">(</span><span class="kt">int</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span> <span class="o">+</span> <span class="n">m</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ds</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">u</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ds</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">ds</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">u</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">);</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">d</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">d</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">)</span> <span class="n">e</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">};</span>
            <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">kruskal</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>

        <span class="n">ds</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Bellman Ford</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3259</span>
<span class="cm"> * PROB: Wormholes</span>
<span class="cm"> * ALGO: Bellman Ford</span>
<span class="cm"> * DATE: Jul 24, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>

    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_d</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">u</span><span class="p">(</span><span class="n">_u</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">510</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>

<span class="kt">bool</span> <span class="n">bellmanFord</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="p">));</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">));</span>
    <span class="p">}</span>
    
    <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">e</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">)</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">e</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">F</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">F</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">F</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bellmanFord</span><span class="p">())</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;YES&quot;</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;NO&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Dijkstra</h2>
<div class="highlight"><pre><span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>

    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_d</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">dijkstra</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">que</span><span class="p">;</span>
    <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">v</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">td</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">d</span><span class="p">;</span> 
        <span class="n">que</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">td</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">d</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">something</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>SPFA</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2983</span>
<span class="cm"> * PROB: Is the Information Reliable?</span>
<span class="cm"> * ALGO: SPFA</span>
<span class="cm"> * DATE: Apr 12, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXE</span> <span class="o">=</span> <span class="mi">300010</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_queue</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Edge</span> <span class="n">e_buf</span><span class="p">[</span><span class="n">MAXE</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">spfa</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">in_queue</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">in_queue</span><span class="p">));</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">que</span><span class="p">;</span>
    <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">que</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">in_queue</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">Edge</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_queue</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
                    <span class="n">in_queue</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">e_head</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_head</span><span class="p">));</span>
        <span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

        <span class="c1">// some points may be isolate, so add a super source 0</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot; %c%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;P&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">);</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// n points plus a super souce, the 0</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">spfa</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Reliable&quot;</span> <span class="o">:</span> <span class="s">&quot;Unreliable&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>SPFA with SLF and LLL</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2983</span>
<span class="cm"> * PROB: Is the Information Reliable?</span>
<span class="cm"> * ALGO: SPFA</span>
<span class="cm"> * DATE: Apr 12, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;deque&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXE</span> <span class="o">=</span> <span class="mi">300010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">gr</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">eps</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">cnt</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_queue</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Edge</span> <span class="n">e_buf</span><span class="p">[</span><span class="n">MAXE</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">spfa</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cnt</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">in_queue</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">in_queue</span><span class="p">));</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">que</span><span class="p">;</span>
    <span class="n">que</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">gr</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">()],</span> <span class="n">avg</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">que</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
            <span class="n">que</span><span class="p">.</span><span class="n">pop_front</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">tot</span> <span class="o">=</span> <span class="n">avg</span> <span class="o">*</span> <span class="n">que</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
        <span class="n">que</span><span class="p">.</span><span class="n">pop_front</span><span class="p">();</span>
        <span class="n">in_queue</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">Edge</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_queue</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">()])</span> <span class="p">{</span>
                        <span class="n">que</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="n">que</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n">tot</span> <span class="o">+=</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
                    <span class="n">in_queue</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">/</span> <span class="n">que</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">e_head</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_head</span><span class="p">));</span>
        <span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

        <span class="c1">// some points may be isolate, so add a super source 0</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot; %c%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;P&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">);</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">add_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// n points plus a super souce, the 0</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">spfa</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Reliable&quot;</span> <span class="o">:</span> <span class="s">&quot;Unreliable&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Tarjan for Strongly Connected Component</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2186</span>
<span class="cm"> * PROB: Popular Cows</span>
<span class="cm"> * ALGO: Tarjan SCC (Strongly Connected Component)</span>
<span class="cm"> * DATE: Jul 23, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">10010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stack</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">scc_cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">scc_id</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">scc_size</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">in_stack</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tarjan_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_stack</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
            <span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
            <span class="n">in_stack</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="n">scc_id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">scc_cnt</span><span class="p">;</span>
            <span class="n">scc_size</span><span class="p">[</span><span class="n">scc_cnt</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">u</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">scc_cnt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">tarjan</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">scc_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dfn</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">low</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">scc_id</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scc_id</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">scc_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scc_size</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">out_deg</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">solve</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scc_cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">n</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">u</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">scc_id</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="n">out_deg</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ans_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scc_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">out_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">scc_size</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">ans_cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">ans_cnt</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">ans</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">tarjan</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">solve</span><span class="p">());</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Tarjan for Vertex Biconnected Component</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: poj 2942</span>
<span class="cm"> * PROB: Knights of the Round Table</span>
<span class="cm"> * ALGO: Tarjan Vertex BCC (Vertex Biconnected Component</span>
<span class="cm"> * DATE: Jul 09, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stack</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bcc_cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">bcc_block</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">in_stack</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tarjan_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">low</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">p</span><span class="p">;</span>
                <span class="k">do</span> <span class="p">{</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
                    <span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
                    <span class="n">in_stack</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="n">bcc_block</span><span class="p">[</span><span class="n">bcc_cnt</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="p">;</span>
                <span class="n">bcc_block</span><span class="p">[</span><span class="n">bcc_cnt</span><span class="o">++</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_stack</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">tarjan</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">bcc_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">stack</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">bcc_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dfn</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">low</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="n">i</span> <span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">mat</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">color</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">to_dye</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">expel</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">bool</span> <span class="n">dye_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">to_dye</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dye_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">col</span> <span class="o">^</span> <span class="mi">1</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">color</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">dye</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">expel</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">expel</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">bcc_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">to_dye</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">to_dye</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">to_dye</span><span class="p">[</span><span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dye_dfs</span><span class="p">(</span><span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">back</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">expel</span><span class="p">[</span><span class="n">bcc_block</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span> <span class="o">||</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">mat</span><span class="p">));</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
            <span class="n">x</span><span class="o">--</span><span class="p">;</span> <span class="n">y</span><span class="o">--</span><span class="p">;</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="n">edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">tarjan</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
        <span class="n">dye</span><span class="p">();</span>

        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">expel</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">ans</span><span class="o">++</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Tarjan for Edge Biconnected Component</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3352</span>
<span class="cm"> * PROB: Road Construction</span>
<span class="cm"> * ALGO: Tarjan Edge BCC (Edge Biconnected Component)</span>
<span class="cm"> * DATE: Apr 12, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">10010</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stack</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bcc_cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">bcc_id</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">bcc_size</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">in_stack</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">v</span> <span class="o">==</span> <span class="n">parent</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tarjan_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_stack</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
            <span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
            <span class="n">in_stack</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="n">bcc_id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">bcc_cnt</span><span class="p">;</span>
            <span class="n">bcc_size</span><span class="p">[</span><span class="n">bcc_cnt</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">u</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">bcc_cnt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">tarjan</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">bcc_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dfn</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">low</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">bcc_id</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bcc_id</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">bcc_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bcc_size</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">degree</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">count_leaves</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">degree</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">u</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">bcc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">bcc_id</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">degree</span><span class="p">[</span><span class="n">bcc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">bcc_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">degree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">tarjan</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">count_leaves</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Tarjan for Lowest Common Ancestor</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1986</span>
<span class="cm"> * PROB: Distance Queries</span>
<span class="cm"> * ALGO: Tarjan LCA (Lowest Common Ancestor)</span>
<span class="cm"> * DATE: May 28, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Disjoint_Set</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="n">Disjoint_Set</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span> <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="p">}</span>

        <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">join</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_d</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">Disjoint_Set</span> <span class="n">ds</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">parent</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">tarjan</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">e</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">query</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">// ds.find(e-&gt;v) is exactly the lowest common ancestor of u and e-&gt;v</span>
            <span class="n">ans</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist</span><span class="p">[</span><span class="n">ds</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">e</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">!=</span> <span class="n">parent</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">parent</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="n">tarjan</span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">,</span> <span class="n">length</span> <span class="o">+</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">ds</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">u</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%*d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">query</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%*s&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">));</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
        <span class="n">query</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
        <span class="n">query</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">parent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tarjan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>2-SAT</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3648</span>
<span class="cm"> * PROB: Wedding</span>
<span class="cm"> * ALGO: 2-SAT</span>
<span class="cm"> * DATE: Oct 16, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">1010</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">new_edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stack</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">scc_cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">scc_id</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">scc_size</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">in_stack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">in_deg</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">color</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">stack</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="n">in_stack</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="o">++</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">tarjan_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">low</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in_stack</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span>
            <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">dfn</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">low</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">stack</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
            <span class="n">stack</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
            <span class="n">in_stack</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="n">scc_id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">scc_cnt</span><span class="p">;</span>
            <span class="n">scc_size</span><span class="p">[</span><span class="n">scc_cnt</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">u</span><span class="p">)</span> <span class="p">;</span>
        <span class="n">scc_cnt</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">tarjan</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">scc_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dfn</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">low</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">scc_id</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scc_id</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">scc_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">scc_size</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">tarjan_dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">color_dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">color</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">new_edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">new_edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">color</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="n">color_dfs</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">sat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">tarjan</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">scc_id</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="n">memset</span><span class="p">(</span><span class="n">in_deg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">in_deg</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">u</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">scc_id</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">new_edge</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]].</span><span class="n">push_back</span><span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
                <span class="n">in_deg</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">Q</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">topo</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scc_cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_deg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">topo</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">new_edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">new_edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">in_deg</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">memset</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">color</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">u</span> <span class="o">=</span> <span class="n">topo</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">topo</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">u</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">color</span><span class="p">[</span><span class="o">*</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">color</span><span class="p">[</span><span class="o">*</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">*</span><span class="n">u</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">color</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]])</span>
                        <span class="n">color_dfs</span><span class="p">(</span><span class="n">scc_id</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">which</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;w&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span> <span class="o">||</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
            <span class="n">new_edge</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span>  <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">;</span>
            <span class="kt">char</span> <span class="n">hw1</span><span class="p">,</span> <span class="n">hw2</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%c%d%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hw1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hw2</span><span class="p">);</span>
            <span class="n">edge</span><span class="p">[(</span><span class="n">id1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">which</span><span class="p">(</span><span class="n">hw1</span><span class="p">)].</span><span class="n">push_back</span><span class="p">((</span><span class="n">id2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="o">!</span><span class="n">which</span><span class="p">(</span><span class="n">hw2</span><span class="p">)));</span>
            <span class="n">edge</span><span class="p">[(</span><span class="n">id2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">which</span><span class="p">(</span><span class="n">hw2</span><span class="p">)].</span><span class="n">push_back</span><span class="p">((</span><span class="n">id1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="o">!</span><span class="n">which</span><span class="p">(</span><span class="n">hw1</span><span class="p">)));</span>
        <span class="p">}</span>
        <span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sat</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">&quot;bad luck&quot;</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
        <span class="kt">bool</span> <span class="n">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">color</span><span class="p">[</span><span class="n">scc_id</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">)</span> <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d%c&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;h&#39;</span> <span class="o">:</span> <span class="sc">&#39;w&#39;</span><span class="p">);</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="n">putchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Hungarian</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3041</span>
<span class="cm"> * PROB: Asteroids</span>
<span class="cm"> * ALGO: Hungarian</span>
<span class="cm"> * DATE: Mar 05, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">555</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">match</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">bool</span> <span class="n">find_path</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">vis</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">find_path</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">match</span><span class="p">[</span><span class="o">*</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">hungarian</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">match</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">find_path</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">res</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hungarian</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>KM</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: HDOJ 3722</span>
<span class="cm"> * PROB: Card Game</span>
<span class="cm"> * ALGO: KM</span>
<span class="cm"> * DATE: Oct 16, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">int</span>  <span class="n">w</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">],</span>
     <span class="n">lx</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">ly</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span>
     <span class="n">match</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">slack</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">visx</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">visy</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">bool</span> <span class="n">find_path</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">visx</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">visy</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">lx</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">ly</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">visy</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">find_path</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span> <span class="p">{</span>
                <span class="n">match</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">slack</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span> <span class="n">slack</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">KM</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">lx</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">ly</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ly</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">match</span><span class="p">));</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="n">lx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">slack</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">slack</span><span class="p">));</span>
        <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">visx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">visx</span><span class="p">));</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">visy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">visy</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">find_path</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">visy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">slack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="n">d</span> <span class="o">=</span> <span class="n">slack</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">visx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">lx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">visy</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="n">ly</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
                <span class="k">else</span> <span class="n">slack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">res</span> <span class="o">+=</span> <span class="n">w</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">i</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="n">card</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">1010</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">eval_w</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">len_a</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">len_a</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="n">a</span><span class="p">[</span><span class="n">len_a</span><span class="p">]</span> <span class="o">==</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="n">res</span><span class="o">++</span><span class="p">,</span> <span class="n">len_a</span><span class="o">--</span><span class="p">,</span> <span class="n">b</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">else</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_w</span><span class="p">(</span><span class="n">card</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">card</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">KM</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Dinic (Pointer)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3281</span>
<span class="cm"> * PROB: Dining</span>
<span class="cm"> * ALGO: Dinic</span>
<span class="cm"> * DATE: Jun 2, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXE</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">orig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">MAXV</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span> <span class="c1">// capa, flow</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">rev</span><span class="p">;</span> <span class="c1">// revese edge</span>
<span class="p">};</span>
<span class="n">Edge</span> <span class="n">e_buf</span><span class="p">[</span><span class="n">MAXE</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_work</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="n">Edge</span> <span class="o">*</span><span class="n">e_tail</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">que</span><span class="p">[</span><span class="n">MAXV</span><span class="p">],</span> <span class="n">lev</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>

    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>

    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">bfs</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">lev</span><span class="p">));</span>

    <span class="kt">int</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">que</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="n">que</span><span class="p">;</span>
    <span class="o">*</span><span class="n">tail</span><span class="o">++</span> <span class="o">=</span> <span class="n">orig</span><span class="p">;</span>
    <span class="n">lev</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">head</span> <span class="o">!=</span> <span class="n">tail</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="o">*</span><span class="n">head</span><span class="o">++</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Edge</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">lev</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="o">*</span><span class="n">tail</span><span class="o">++</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">lev</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">dest</span><span class="p">)</span> <span class="k">return</span> <span class="n">f</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Edge</span> <span class="o">*&amp;</span><span class="n">e</span> <span class="o">=</span> <span class="n">e_work</span><span class="p">[</span><span class="n">u</span><span class="p">];</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">lev</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">res</span><span class="p">,</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">c</span> <span class="o">-</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">));</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">e</span><span class="o">-&gt;</span><span class="n">rev</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="n">f</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">dinic</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">bfs</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">e_work</span><span class="p">,</span> <span class="n">e_head</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_head</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="n">res</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">build_graph</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">D</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">N</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">F</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">D</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * 0: orig</span>
<span class="cm">     * 1 to F: FF</span>
<span class="cm">     * F + 1 to F + N: C1</span>
<span class="cm">     * F + N + 1 to F + 2N: C2</span>
<span class="cm">     * F + 2N + 1 to F + 2N + D: DD</span>
<span class="cm">     * MAXV: dest</span>
<span class="cm">     */</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">FF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">F</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="n">N</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// orig -&gt; FF, capa = 1</span>
        <span class="c1">// FF -&gt; orig, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">FF</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// C1 -&gt; C2, capa = 1</span>
        <span class="c1">// C2 -&gt; C1, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">C1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">C2</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span><span class="n">D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// DD -&gt; dest, capa = 1</span>
        <span class="c1">// dest -&gt; DD, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">DD</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">f</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
            <span class="c1">// FF -&gt; C1, capa = 1</span>
            <span class="c1">// C1 -&gt; FF, capa = 0</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">FF</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">C1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
            <span class="c1">// C2 -&gt; DD, capa = 1</span>
            <span class="c1">// DD -&gt; C2, capa = 0</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">C2</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">DD</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// memset(e_buf, 0, sizeof(e_buf));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">e_head</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_head</span><span class="p">));</span>
    <span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

    <span class="n">build_graph</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dinic</span><span class="p">());</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Dinic (STL)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3281</span>
<span class="cm"> * PROB: Dining</span>
<span class="cm"> * ALGO: Dinic</span>
<span class="cm"> * DATE: Jun 2, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">orig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">MAXN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rev</span><span class="p">;</span> <span class="c1">// the position of revese edge</span>
    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span> <span class="c1">// capa, flow</span>

    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_rev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_c</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">rev</span><span class="p">(</span><span class="n">_rev</span><span class="p">),</span> <span class="n">c</span><span class="p">(</span><span class="n">_c</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">lev</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">capa</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">size</span><span class="p">(),</span> <span class="n">capa</span><span class="p">));</span>
    <span class="n">edge</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">bfs</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">lev</span><span class="p">));</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">Q</span><span class="p">;</span>
    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">orig</span><span class="p">);</span>
    <span class="n">lev</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lev</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">lev</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">lev</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">dest</span><span class="p">)</span> <span class="k">return</span> <span class="n">f</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lev</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">lev</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">res</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">c</span> <span class="o">-</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">));</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">rev</span><span class="p">;</span>
            <span class="n">edge</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="n">f</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">dinic</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">bfs</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">MAXN</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="n">res</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">build_graph</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">D</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">N</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">F</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">D</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * 0: orig</span>
<span class="cm">     * 1 to F: FF</span>
<span class="cm">     * F + 1 to F + N: C1</span>
<span class="cm">     * F + N + 1 to F + 2N: C2</span>
<span class="cm">     * F + 2N + 1 to F + 2N + D: DD</span>
<span class="cm">     * MAXN: dest</span>
<span class="cm">     */</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">FF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">F</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="n">N</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">DD</span> <span class="o">=</span> <span class="n">F</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">F</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// orig -&gt; FF, capa = 1</span>
        <span class="c1">// FF -&gt; orig, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">FF</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// C1 -&gt; C2, capa = 1</span>
        <span class="c1">// C2 -&gt; C1, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">C1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">C2</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span><span class="n">D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// DD -&gt; dest, capa = 1</span>
        <span class="c1">// dest -&gt; DD, capa = 0</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">DD</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">f</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">f</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
            <span class="c1">// FF -&gt; C1, capa = 1</span>
            <span class="c1">// C1 -&gt; FF, capa = 0</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">FF</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">C1</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
            <span class="c1">// C2 -&gt; DD, capa = 1</span>
            <span class="c1">// DD -&gt; C2, capa = 0</span>
            <span class="n">add_edge</span><span class="p">(</span><span class="n">C2</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">DD</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">build_graph</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dinic</span><span class="p">());</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Minimum Cost Flow (pointer)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2135</span>
<span class="cm"> * PROB: Farm Tour</span>
<span class="cm"> * ALGO: MCMF</span>
<span class="cm"> * DATE: Jul 25, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXV</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXE</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">orig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span> <span class="c1">// capa, flow</span>
    <span class="kt">int</span> <span class="n">cpf</span><span class="p">;</span> <span class="c1">// cost per flow</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">next</span><span class="p">,</span>
         <span class="o">*</span><span class="n">rev</span><span class="p">;</span> <span class="c1">// revese edge</span>
<span class="p">};</span>
<span class="n">Edge</span> <span class="n">e_buf</span><span class="p">[</span><span class="n">MAXE</span><span class="p">],</span>
     <span class="o">*</span><span class="n">e_tail</span><span class="p">,</span>
     <span class="o">*</span><span class="n">e_head</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">RoadNode</span> <span class="p">{</span>
    <span class="n">RoadNode</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">Edge</span> <span class="o">*</span><span class="n">which</span><span class="p">;</span> <span class="c1">// which edge</span>
<span class="p">};</span>
<span class="n">RoadNode</span> <span class="n">road</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">que</span><span class="p">[</span><span class="n">MAXE</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXV</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cpf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cpf</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>

    <span class="o">*</span><span class="n">e_tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">Edge</span><span class="p">){</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cpf</span><span class="p">,</span> <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]};</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_tail</span><span class="o">++</span><span class="p">;</span>

    <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
    <span class="n">e_head</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">spfa</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>

    <span class="kt">int</span> <span class="o">*</span><span class="n">head</span> <span class="o">=</span> <span class="n">que</span><span class="p">,</span>
        <span class="o">*</span><span class="n">tail</span> <span class="o">=</span> <span class="n">que</span><span class="p">;</span>
    <span class="o">*</span><span class="n">tail</span><span class="o">++</span> <span class="o">=</span> <span class="n">orig</span><span class="p">;</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">road</span><span class="p">[</span><span class="n">orig</span><span class="p">].</span><span class="n">next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">head</span> <span class="o">!=</span> <span class="n">tail</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="o">*</span><span class="n">head</span><span class="o">++</span><span class="p">;</span>
        <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Edge</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="n">e_head</span><span class="p">[</span><span class="n">u</span><span class="p">];</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">cpf</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">cpf</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="n">road</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">].</span><span class="n">next</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">road</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="n">road</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">].</span><span class="n">which</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="o">*</span><span class="n">tail</span><span class="o">++</span> <span class="o">=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">dist</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">INF</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">flow</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">min_flow</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">RoadNode</span> <span class="o">*</span><span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">road</span><span class="p">[</span><span class="n">dest</span><span class="p">];</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
        <span class="n">min_flow</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">min_flow</span><span class="p">,</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">c</span> <span class="o">-</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">RoadNode</span> <span class="o">*</span><span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">road</span><span class="p">[</span><span class="n">dest</span><span class="p">];</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">+=</span> <span class="n">min_flow</span><span class="p">;</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">cpf</span><span class="p">;</span>
        <span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">rev</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">*=</span> <span class="n">min_flow</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">mcmf</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">spfa</span><span class="p">())</span> <span class="n">res</span> <span class="o">+=</span> <span class="n">flow</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">build_graph</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="n">add_edge</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">e_buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_buf</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">e_head</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">e_head</span><span class="p">));</span>
    <span class="n">e_tail</span> <span class="o">=</span> <span class="n">e_buf</span><span class="p">;</span>

    <span class="n">build_graph</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">mcmf</span><span class="p">());</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Minimum Cost Flow (STL)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2135</span>
<span class="cm"> * PROB: Farm Tour</span>
<span class="cm"> * ALGO: MCMF</span>
<span class="cm"> * DATE: Jul 25, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;queue&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">fmin</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">1010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">orig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">MAXN</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rev</span><span class="p">;</span> <span class="c1">// the position of revese edge</span>
    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span> <span class="c1">// capa, flow</span>
    <span class="kt">int</span> <span class="n">cpf</span><span class="p">;</span> <span class="c1">// cost per flow</span>

    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_rev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_cpf</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">rev</span><span class="p">(</span><span class="n">_rev</span><span class="p">),</span> <span class="n">c</span><span class="p">(</span><span class="n">_c</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cpf</span><span class="p">(</span><span class="n">_cpf</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Route</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">which</span><span class="p">;</span>

    <span class="n">Route</span><span class="p">(</span><span class="kt">int</span> <span class="n">_u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_which</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">u</span><span class="p">(</span><span class="n">_u</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">which</span><span class="p">(</span><span class="n">_which</span><span class="p">)</span>
    <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">Route</span> <span class="n">bfs_route</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="n">add_edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">capa</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cpf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">size</span><span class="p">(),</span> <span class="n">capa</span><span class="p">,</span> <span class="n">cpf</span><span class="p">));</span>
    <span class="n">edge</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cpf</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">spfa</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dist</span><span class="p">));</span>

    <span class="n">queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">Q</span><span class="p">;</span>
    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">orig</span><span class="p">);</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bfs_route</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Q</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">Q</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">,</span>
                <span class="n">cpf</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">cpf</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cpf</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpf</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
                <span class="n">bfs_route</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">Route</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="n">Q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">dist</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">INF</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">flow</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">min_flow</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
    <span class="n">Route</span> <span class="o">*</span><span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfs_route</span><span class="p">[</span><span class="n">dest</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">min_flow</span> <span class="o">=</span> <span class="n">fmin</span><span class="p">(</span><span class="n">min_flow</span><span class="p">,</span> <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">c</span> <span class="o">-</span> <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">f</span><span class="p">);</span>
        <span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfs_route</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfs_route</span><span class="p">[</span><span class="n">dest</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">f</span> <span class="o">+=</span> <span class="n">min_flow</span><span class="p">;</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">cpf</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">rev</span><span class="p">;</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">][</span><span class="n">j</span><span class="p">].</span><span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">edge</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">][</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">which</span><span class="p">].</span><span class="n">f</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfs_route</span><span class="p">[</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">*=</span> <span class="n">min_flow</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">mcmf</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">spfa</span><span class="p">())</span> <span class="n">res</span> <span class="o">+=</span> <span class="n">flow</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">build_graph</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="n">add_edge</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">build_graph</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">mcmf</span><span class="p">());</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Stoer Wagner</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: HDOJ 3691</span>
<span class="cm"> * PROB: Nubulsa Expo</span>
<span class="cm"> * ALGO: Stoer-Wagner</span>
<span class="cm"> * DATE: Oct 12, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">333</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">mat</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">bool</span> <span class="n">A</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">stoer_wagner</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">curr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">curr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]]))</span>
                    <span class="n">curr</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]])</span> <span class="n">res</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]];</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">mat</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">v</span><span class="p">[</span><span class="n">prev</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">prev</span><span class="p">]][</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">mat</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]][</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
                <span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">--</span><span class="n">n</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">prev</span> <span class="o">=</span> <span class="n">curr</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">A</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">mat</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">curr</span><span class="p">]][</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%*d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">),</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">mat</span><span class="p">));</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
            <span class="n">a</span><span class="o">--</span><span class="p">,</span> <span class="n">b</span><span class="o">--</span><span class="p">;</span>
            <span class="n">mat</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">stoer_wagner</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="page-break"></div>
<h1>Tree</h1>
<h2>BIT</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2352</span>
<span class="cm"> * PROB: Stars</span>
<span class="cm"> * ALGO: BIT</span>
<span class="cm"> * DATE: Jul 20, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BIT</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">bound</span> <span class="o">=</span> <span class="mi">320010</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">bound</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">bit_mask</span><span class="p">;</span>

        <span class="c1">// x must *not* be *zero*</span>
        <span class="kt">int</span> <span class="n">lowbit</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">;</span> <span class="p">}</span>

        <span class="kt">void</span> <span class="n">get_bit_mask</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">bound</span> <span class="o">&gt;&gt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
                <span class="p">;</span>

            <span class="n">bit_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">bound</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">-=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// get_bit_mask() first</span>
        <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">tot</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bm</span> <span class="o">=</span> <span class="n">bit_mask</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">bm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">+</span> <span class="n">bm</span> <span class="o">&lt;</span> <span class="n">bound</span> <span class="o">&amp;&amp;</span> <span class="n">cnt</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">res</span> <span class="o">+</span> <span class="n">bm</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tot</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// find the left one</span>
             <span class="c1">// if (res + bm &lt;=bound &amp;&amp; cnt + c[res + bm] &lt;=tot)   // find the right one</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">bm</span><span class="p">;</span>
                    <span class="n">cnt</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">res</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="n">bm</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// left</span>
         <span class="c1">// return res;     // right</span>
        <span class="p">}</span>
<span class="p">};</span>
<span class="n">BIT</span> <span class="n">bit</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">star</span><span class="p">[</span><span class="mi">15010</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">level</span><span class="p">[</span><span class="mi">15010</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">star</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">star</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">star</span><span class="p">,</span> <span class="n">star</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">bit</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">star</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">level</span><span class="p">[</span><span class="n">bit</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="n">star</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>BIT-2D</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1195</span>
<span class="cm"> * PROB: Mobile phones</span>
<span class="cm"> * ALGO: 2D BIT(Binary Indexed Tree)</span>
<span class="cm"> * DATE: Jul 19, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>

<span class="k">class</span> <span class="nc">BIT_2D</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">bound_x</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">bound_y</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">c</span><span class="p">[</span><span class="n">bound_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">bound_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

        <span class="c1">// x must *not* be *zero*</span>
        <span class="kt">int</span> <span class="n">lowbit</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">bound_x</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="n">ty</span> <span class="o">&lt;=</span> <span class="n">bound_y</span><span class="p">;</span> <span class="n">ty</span> <span class="o">+=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">ty</span><span class="p">))</span>
                    <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">ty</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">sum</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">x</span><span class="p">;</span> <span class="n">x</span> <span class="o">-=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span> <span class="n">ty</span><span class="p">;</span> <span class="n">ty</span> <span class="o">-=</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">ty</span><span class="p">))</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">ty</span><span class="p">];</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>
<span class="n">BIT_2D</span> <span class="n">bit</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ins</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ins</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ins</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span> <span class="o">&amp;&amp;</span> <span class="n">ins</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
            <span class="n">bit</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bit</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">bit</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> \
                           <span class="n">bit</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">bit</span><span class="p">.</span><span class="n">sum</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Segment Tree (heap)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3264</span>
<span class="cm"> * PROB: Balanced Lineup</span>
<span class="cm"> * ALGO: Segment Tree</span>
<span class="cm"> * DATE: Jul 21, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">LC</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">RC</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">Segment_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3FFFFFFF</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">;</span> <span class="c1">// min, max</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="mi">200000</span><span class="p">];</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mn</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="o">-</span><span class="n">INF</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="n">build</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mn</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mn</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
                <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
                <span class="k">return</span> <span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mn</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mn</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mn</span><span class="p">);</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">mn</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">mx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="n">mn</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mn</span><span class="p">;</span>
                <span class="o">*</span><span class="n">mx</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span><span class="p">;</span>
                <span class="k">return</span> <span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">int</span> <span class="n">l_mn</span> <span class="o">=</span> <span class="n">INF</span><span class="p">,</span> <span class="n">l_mx</span> <span class="o">=</span> <span class="o">-</span><span class="n">INF</span><span class="p">,</span> <span class="n">r_mn</span> <span class="o">=</span> <span class="n">INF</span><span class="p">,</span> <span class="n">r_mx</span> <span class="o">=</span> <span class="o">-</span><span class="n">INF</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">query</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l_mn</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l_mx</span><span class="p">,</span> <span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">query</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r_mn</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r_mx</span><span class="p">,</span> <span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="o">*</span><span class="n">mn</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">l_mn</span><span class="p">,</span> <span class="n">r_mn</span><span class="p">);</span>
            <span class="o">*</span><span class="n">mx</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">l_mx</span><span class="p">,</span> <span class="n">r_mx</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">Segment_Tree</span> <span class="n">st</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>

    <span class="n">st</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>
        <span class="n">st</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">q</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">;</span>
        <span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mn</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mx</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">mx</span> <span class="o">-</span> <span class="n">mn</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Segment Tree (pointer)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2777</span>
<span class="cm"> * PROB: Count Color</span>
<span class="cm"> * ALGO: Segment Tree</span>
<span class="cm"> * DATE: Jul 20, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>

<span class="k">class</span> <span class="nc">Segment_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// segment [a, b)</span>
            <span class="kt">int</span> <span class="n">cover</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">pure</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">lc</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">rc</span><span class="p">;</span>

            <span class="n">Tnode</span><span class="p">(</span><span class="kt">int</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_b</span><span class="p">)</span>
                <span class="o">:</span> <span class="n">a</span><span class="p">(</span><span class="n">_a</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">_b</span><span class="p">),</span> <span class="n">cover</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">pure</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lc</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span> <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span> <span class="o">=</span> <span class="n">build</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">_insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color</span><span class="p">,</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">pure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>

                <span class="k">return</span> <span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">pure</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">pure</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">;</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="o">-&gt;</span><span class="n">pure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

                <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">;</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="o">-&gt;</span><span class="n">pure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">);</span>
            <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">|</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">_query</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">pure</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">res</span> <span class="o">|=</span> <span class="n">_query</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">res</span> <span class="o">|=</span> <span class="n">_query</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Segment_Tree</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_query</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">o</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">);</span>

    <span class="n">Segment_Tree</span> <span class="n">st</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">o</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">ctrl</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s%d%d&quot;</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ctrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;C&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
            <span class="n">st</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
                <span class="n">colors</span> <span class="o">-=</span> <span class="n">colors</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">colors</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Segment Tree (discrete)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2482</span>
<span class="cm"> * PROB: Stars in Your Window</span>
<span class="cm"> * ALGO: Segment Tree</span>
<span class="cm"> * DATE: Sep 07, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">10010</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">INF</span> <span class="o">=</span> <span class="mh">0x3FFFFFFF</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">eq</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">ls</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">LC</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">int</span> <span class="n">RC</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">Segment_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">mx</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">*</span> <span class="mi">20</span><span class="p">];</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="o">-</span><span class="n">INF</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="n">build</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
                <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">)</span> \
                               <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
                <span class="k">return</span> <span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">a</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">mx</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">idx</span><span class="p">)].</span><span class="n">mx</span><span class="p">)</span> \
                           <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">query</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mx</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Discrete</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">new_y</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp_y</span><span class="p">(</span><span class="k">const</span> <span class="n">Discrete</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Discrete</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ls</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="p">}</span>
<span class="kr">inline</span> <span class="kt">bool</span> <span class="n">cmp_id</span><span class="p">(</span><span class="k">const</span> <span class="n">Discrete</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Discrete</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">;</span> <span class="p">}</span>

<span class="k">struct</span> <span class="n">Segment</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Segment</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">v</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">Segment_Tree</span> <span class="n">st</span><span class="p">;</span>
<span class="n">Point</span> <span class="n">p</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">Discrete</span> <span class="n">dy</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>
<span class="n">Segment</span> <span class="n">seg</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">*</span> <span class="mi">2</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">W</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">H</span><span class="p">)</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">dw</span> <span class="o">=</span> <span class="n">W</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dh</span> <span class="o">=</span> <span class="n">H</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">);</span>
            <span class="n">dy</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">id</span> <span class="o">=</span> <span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">dy</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">dh</span><span class="p">;</span>
            <span class="n">dy</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">id</span> <span class="o">=</span> <span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">dy</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">+</span> <span class="n">dh</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">sort</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cmp_y</span><span class="p">);</span>
        <span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">new_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">eq</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">y</span><span class="p">))</span> <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
            <span class="n">dy</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">new_y</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cmp_id</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">dw</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">b</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">new_y</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">e</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">new_y</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">v</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>

            <span class="n">seg</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">dw</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">b</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="n">LC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">new_y</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">e</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">new_y</span><span class="p">;</span>
            <span class="n">seg</span><span class="p">[</span><span class="n">RC</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">seg</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="o">-</span><span class="n">INF</span><span class="p">;</span>
        <span class="n">st</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">st</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">,</span> <span class="n">seg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">);</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Segment Tree (perimeter)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1177</span>
<span class="cm"> * PROB: Picture</span>
<span class="cm"> * ALGO: Segment Tree</span>
<span class="cm"> * DATE: Jul 21, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstdlib&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Segment_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// segment [a, b)</span>
            <span class="kt">int</span> <span class="n">cover</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">lc</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">rc</span><span class="p">;</span>

            <span class="n">Tnode</span><span class="p">(</span><span class="kt">int</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_b</span><span class="p">)</span>
                <span class="o">:</span> <span class="n">a</span><span class="p">(</span><span class="n">_a</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">_b</span><span class="p">),</span> <span class="n">cover</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">len</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lc</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span> <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>

        <span class="kt">void</span> <span class="n">_insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">,</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">+=</span> <span class="n">delta</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                    <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">((</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">)</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">)</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
            <span class="k">else</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Segment_Tree</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">query</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
        <span class="p">}</span>

<span class="p">};</span>

<span class="k">struct</span> <span class="n">Line</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">delta</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">// if two edges are on the same line, first add, then delete;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">delta</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">Line</span> <span class="n">X</span><span class="p">[</span><span class="mi">10010</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="mi">10010</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y2</span><span class="p">);</span>
        <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">x2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">;</span> <span class="n">Y</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">);</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Segment_Tree</span> <span class="n">st_x</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10001</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">st_x</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y1</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y2</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">abs</span><span class="p">(</span><span class="n">curr</span> <span class="o">-</span> <span class="n">st_x</span><span class="p">.</span><span class="n">query</span><span class="p">());</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="n">st_x</span><span class="p">.</span><span class="n">query</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">Segment_Tree</span> <span class="n">st_y</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10001</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">st_y</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y1</span><span class="p">,</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y2</span><span class="p">,</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">abs</span><span class="p">(</span><span class="n">curr</span> <span class="o">-</span> <span class="n">st_y</span><span class="p">.</span><span class="n">query</span><span class="p">());</span>
        <span class="n">curr</span> <span class="o">=</span> <span class="n">st_y</span><span class="p">.</span><span class="n">query</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Segment Tree (area)</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1389</span>
<span class="cm"> * PROB: Area of Simple Polygons</span>
<span class="cm"> * ALGO: Segment Tree</span>
<span class="cm"> * DATE: Jul 21, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Segment_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// segment [a, b)</span>
            <span class="kt">int</span> <span class="n">cover</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">lc</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">rc</span><span class="p">;</span>

            <span class="n">Tnode</span><span class="p">(</span><span class="kt">int</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_b</span><span class="p">)</span>
                <span class="o">:</span> <span class="n">a</span><span class="p">(</span><span class="n">_a</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="n">_b</span><span class="p">),</span> <span class="n">cover</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">len</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lc</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span> <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">,</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span> <span class="o">+=</span> <span class="n">delta</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                    <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">((</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">cover</span><span class="p">)</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">b</span> <span class="o">-</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="p">)</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">lc</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rc</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
            <span class="k">else</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Segment_Tree</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">insert</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">query</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">root</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Line</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">delta</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="c1">// if two edges are on the same line, first add, then delete;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">delta</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">fmax</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>

<span class="n">Line</span> <span class="n">X</span><span class="p">[</span><span class="mi">2012</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">x2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">x2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

            <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">x2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="p">].</span><span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span> <span class="n">X</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">].</span><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

            <span class="n">maxY</span> <span class="o">=</span> <span class="n">fmax</span><span class="p">(</span><span class="n">maxY</span><span class="p">,</span> <span class="n">fmax</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>

            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">y2</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">sort</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span> <span class="o">+</span> <span class="n">cnt</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">Segment_Tree</span> <span class="n">st</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxY</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">preL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">preX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">st</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y1</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y2</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">delta</span><span class="p">);</span>
            <span class="n">ans</span> <span class="o">+=</span> <span class="n">preL</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">preX</span><span class="p">);</span>
            <span class="n">preL</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">query</span><span class="p">();</span>
            <span class="n">preX</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Partition Tree</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2104</span>
<span class="cm"> * PROB: K-th Number</span>
<span class="cm"> * ALGO: Partition Tree</span>
<span class="cm"> * DATE: Sep 08, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">100010</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Partition_Tree</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">};</span>
        <span class="n">Tnode</span> <span class="n">node</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">];</span>

        <span class="kt">int</span> <span class="n">lcnt</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">seg</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="kt">void</span> <span class="n">_build</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

            <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">lmid</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the number of numbers which equal sorted[mid]</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sorted</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="n">lmid</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">int</span> <span class="n">lpos</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">rpos</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">a</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sorted</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
                    <span class="n">seg</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">lpos</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sorted</span><span class="p">[</span><span class="n">mid</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">seg</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">rpos</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lmid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">lmid</span><span class="o">--</span><span class="p">;</span>
                    <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
                    <span class="n">seg</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">lpos</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">seg</span><span class="p">[</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">rpos</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">_build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">_build</span><span class="p">(</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">_query</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">seg</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">a</span><span class="p">];</span>

            <span class="kt">int</span> <span class="n">ld</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span>
                <span class="n">lseg</span> <span class="o">=</span> <span class="n">lcnt</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ld</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lseg</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">_query</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">+</span> <span class="n">ld</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">+</span> <span class="n">ld</span> <span class="o">+</span> <span class="n">lseg</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">node</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">l</span> <span class="o">-</span> <span class="n">ld</span><span class="p">,</span>
                <span class="n">rseg</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">-</span> <span class="n">lseg</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_query</span><span class="p">(</span><span class="n">mid</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">+</span> <span class="n">rseg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="n">lseg</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">sorted</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sorted</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">));</span>
            <span class="n">sort</span><span class="p">(</span><span class="n">sorted</span><span class="p">,</span> <span class="n">sorted</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">);</span>
            <span class="n">_build</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_query</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">Partition_Tree</span> <span class="n">pt</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pt</span><span class="p">.</span><span class="n">sorted</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">pt</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pt</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Splay</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2761</span>
<span class="cm"> * PROB: Feed the dogs</span>
<span class="cm"> * ALGO: Splay</span>
<span class="cm"> * DATE: Sep 08, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">100010</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Splay</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">BUF_SIZE</span> <span class="o">=</span> <span class="n">MAXN</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">tree_size</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">key</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">cnt</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">l</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="n">Tnode</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">buf_tail</span><span class="p">;</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">get_max</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">get_min</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">update_size</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">update_larger_size</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">end</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">end</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
            <span class="n">update_larger_size</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">update_smaller_size</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">Tnode</span> <span class="o">*</span><span class="n">end</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">end</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>
            <span class="n">update_smaller_size</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">left_rotate</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">right_rotate</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">splay</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span>

            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tnode</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">larger</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">smaller</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">right_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
                    <span class="n">larger</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="n">larger</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="c1">// key &gt; x-&gt;key</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&amp;&amp;</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">left_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
                    <span class="n">smaller</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="n">smaller</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">larger</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">smaller</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">update_larger_size</span><span class="p">(</span><span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">larger</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">);</span>
            <span class="n">update_smaller_size</span><span class="p">(</span><span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span> <span class="n">smaller</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">);</span>

            <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

            <span class="k">delete</span> <span class="n">y</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">insert</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">++</span><span class="p">;</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">tree_size</span><span class="o">++</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">buf_tail</span><span class="o">++</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">y</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
                <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
                <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">erase</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">--</span><span class="p">;</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="o">--</span><span class="p">;</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="n">tree_size</span><span class="o">--</span><span class="p">;</span>
                <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
                    <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
                    <span class="n">update_size</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Splay</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">root</span><span class="p">;</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">erase</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span>  <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">erase</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">tree_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
            <span class="n">buf_tail</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* find the kth smallest one */</span>
        <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">k</span> <span class="o">-=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Query</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">ans</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span> <span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">l</span><span class="p">)</span> <span class="k">return</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">l</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">cmp_id</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">;</span> <span class="p">}</span>

<span class="n">Splay</span> <span class="n">splay</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="n">Query</span> <span class="n">q</span><span class="p">[</span><span class="mi">50010</span><span class="p">];</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">v</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">);</span>
        <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="n">m</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">r</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">splay</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ans</span> <span class="o">=</span> <span class="n">splay</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">k</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">r</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">splay</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">splay</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">splay</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">splay</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">r</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">splay</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ans</span> <span class="o">=</span> <span class="n">splay</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="n">m</span><span class="p">,</span> <span class="n">cmp_id</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ans</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Treap</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2985</span>
<span class="cm"> * PROB: The k-th Largest Group</span>
<span class="cm"> * ALGO: Treap</span>
<span class="cm"> * DATE: Sep 05, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;cstdlib&gt;</span>
<span class="cp">#include &lt;ctime&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">200010</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Treap</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="k">const</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">BUF_SIZE</span> <span class="o">=</span> <span class="n">MAXN</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">tree_size</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">Tnode</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="n">fix</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">cnt</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">l</span><span class="p">;</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="n">Tnode</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>
        <span class="n">Tnode</span> <span class="o">*</span><span class="n">buf_tail</span><span class="p">;</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">get_max</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">get_min</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">const</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">update_size</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">left_rotate</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>

            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">right_rotate</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
            <span class="n">y</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>

            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">update_size</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">insert</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">tree_size</span><span class="o">++</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">buf_tail</span><span class="o">++</span><span class="p">;</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">;</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">fix</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="n">rand</span><span class="p">();</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">fix</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">fix</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">right_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">fix</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">fix</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">left_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Tnode</span> <span class="o">*</span><span class="n">erase</span><span class="p">(</span><span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">=</span> <span class="n">erase</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">)</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">=</span> <span class="n">erase</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="o">--</span><span class="p">;</span>
                    <span class="n">x</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">--</span><span class="p">;</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">tree_size</span><span class="o">--</span><span class="p">;</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">left_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">right_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="o">-&gt;</span><span class="n">fix</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">fix</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">right_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">else</span> <span class="n">x</span> <span class="o">=</span> <span class="n">left_rotate</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">erase</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">update_size</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="n">Treap</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">bool</span> <span class="n">empty</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">root</span><span class="p">;</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">erase</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span> <span class="n">root</span> <span class="o">=</span> <span class="n">erase</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">key</span><span class="p">);</span> <span class="p">}</span>

        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">tree_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
            <span class="n">buf_tail</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
            <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* find the kth largest one */</span>
        <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Tnode</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">)</span> <span class="n">k</span> <span class="o">-=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
                <span class="n">k</span> <span class="o">-=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">cnt</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Disjoint_Set</span> <span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>

    <span class="k">public</span><span class="o">:</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="n">Disjoint_Set</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span> <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="p">}</span>

        <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">join</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">Treap</span> <span class="n">treap</span><span class="p">;</span>
<span class="n">Disjoint_Set</span> <span class="n">ds</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">combine</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">treap</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">-</span><span class="n">ds</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>
        <span class="n">treap</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">-</span><span class="n">ds</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]);</span>
        <span class="n">ds</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">treap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="n">ds</span><span class="p">.</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">treap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">j</span><span class="p">);</span>
            <span class="n">combine</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">treap</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="page-break"></div>
<h1>Other</h1>
<h2>Disjoint Set</h2>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Disjoint_Set</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="c1">// a[i] &gt; 0: a[i] is i&#39;s ancestor;</span>
        <span class="c1">// a[i] &lt; 0: -a[i] is the number of elements sharing the same ancestor i</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

        <span class="n">Disjoint_Set</span><span class="p">()</span> <span class="p">{</span> <span class="n">reset</span><span class="p">();</span> <span class="p">}</span>
        <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span> <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="p">}</span>

        <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">u</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">join</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">];</span>
                <span class="n">a</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
<h2>Heap</h2>
<div class="highlight"><pre><span class="kt">void</span> <span class="n">adjust_heap</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">last</span><span class="p">,</span> <span class="kt">int</span> <span class="n">curr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">curr</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">child</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">child</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">child</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">child</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">curr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">child</span><span class="p">))</span>
            <span class="n">swap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">curr</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">child</span><span class="p">));</span>
        <span class="k">else</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">curr</span> <span class="o">=</span> <span class="n">child</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">push_heap</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">first</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">curr</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">parent</span> <span class="o">=</span> <span class="p">(</span><span class="n">curr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">parent</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">curr</span><span class="p">))</span>
            <span class="n">swap</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">curr</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">first</span> <span class="o">+</span> <span class="n">parent</span><span class="p">));</span>
        <span class="k">else</span> <span class="k">break</span><span class="p">;</span>

        <span class="n">curr</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">pop_heap</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">swap</span><span class="p">(</span><span class="o">*</span><span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">adjust_heap</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">make_heap</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">curr</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">curr</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span> <span class="n">push_heap</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">curr</span><span class="o">++</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">sort_heap</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">last</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span> <span class="n">pop_heap</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="o">--</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<h2>Merge Sort</h2>
<div class="highlight"><pre><span class="kt">void</span> <span class="n">merge_sort</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// [l, r)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="k">return</span> <span class="p">;</span>

    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">merge_sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">);</span>
    <span class="n">merge_sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>

    <span class="kt">int</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">mid</span> <span class="o">&amp;&amp;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">[</span><span class="n">q</span><span class="p">])</span> <span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">++</span><span class="p">];</span>
        <span class="k">else</span> <span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">q</span><span class="o">++</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">)</span> <span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">++</span><span class="p">];</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">)</span>   <span class="n">b</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">q</span><span class="o">++</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="k">delete</span><span class="p">[]</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Inversion Pair</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: NKOJ p1121</span>
<span class="cm"> * PROB: Ultra-QuickSort</span>
<span class="cm"> * ALGO: Merge Sort</span>
<span class="cm"> * DATE: Jun 7, 2011</span>
<span class="cm"> * COMP: jdk 6</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Prob</span><span class="o">().</span><span class="na">solve</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Prob</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mergeSort</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">[],</span> <span class="kt">int</span> <span class="n">l</span><span class="o">,</span> <span class="kt">int</span> <span class="n">r</span><span class="o">)</span> <span class="c1">// [l, r)</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">r</span><span class="o">)</span> <span class="k">return</span> <span class="o">;</span>

        <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="o">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
        <span class="n">mergeSort</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">mid</span><span class="o">);</span>
        <span class="n">mergeSort</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">mid</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">b</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">l</span><span class="o">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mid</span><span class="o">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">mid</span> <span class="o">&amp;&amp;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">a</span><span class="o">[</span><span class="n">p</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">[</span><span class="n">q</span><span class="o">])</span> <span class="n">b</span><span class="o">[</span><span class="n">cnt</span><span class="o">++]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">p</span><span class="o">++];</span>
            <span class="k">else</span> <span class="o">{</span>
                <span class="n">b</span><span class="o">[</span><span class="n">cnt</span><span class="o">++]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">q</span><span class="o">++];</span>
                <span class="n">ans</span> <span class="o">+=</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">p</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="o">)</span> <span class="n">b</span><span class="o">[</span><span class="n">cnt</span><span class="o">++]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">p</span><span class="o">++];</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">)</span>   <span class="n">b</span><span class="o">[</span><span class="n">cnt</span><span class="o">++]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">q</span><span class="o">++];</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="n">a</span><span class="o">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">solve</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Scanner</span> <span class="n">cin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">cin</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">break</span><span class="o">;</span>

            <span class="kt">int</span> <span class="n">a</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">cin</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>

            <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="n">mergeSort</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ans</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<h2>Monotone Priority Queue</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1821</span>
<span class="cm"> * PROB: Fence</span>
<span class="cm"> * ALGO: DP + Monotone Priority Queue(decrease)</span>
<span class="cm"> * DATE: Jul 21, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">f</span><span class="p">[</span><span class="mi">101</span><span class="p">][</span><span class="mi">16001</span><span class="p">],</span> <span class="n">que</span><span class="p">[</span><span class="mi">16001</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Node</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="n">worker</span><span class="p">[</span><span class="mi">101</span><span class="p">];</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="n">key</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">*</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * f[i][j] = {</span>
<span class="cm"> *              f[i - 1][j],</span>
<span class="cm"> *              f[i][j - 1],</span>
<span class="cm"> *              f[i - 1][k] + (j - k) * worker[i].p =&gt; (f[i - 1][k] - k * worker[i].p) + j * worker[i].p</span>
<span class="cm"> *           }</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span><span class="p">);</span>

    <span class="n">sort</span><span class="p">(</span><span class="n">worker</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">worker</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>

        <span class="kt">int</span> <span class="n">head</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span> <span class="o">-</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">que</span><span class="p">[</span><span class="n">tail</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">key</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="n">tail</span><span class="o">--</span><span class="p">;</span>
            <span class="n">que</span><span class="p">[</span><span class="n">tail</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span><span class="p">,</span> <span class="n">finish</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span> <span class="o">+</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">finish</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span> <span class="o">&amp;&amp;</span> <span class="n">que</span><span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">-</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">)</span> <span class="n">head</span><span class="o">++</span><span class="p">;</span>
            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">key</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">que</span><span class="p">[</span><span class="n">head</span><span class="p">])</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">s</span> <span class="o">+</span> <span class="n">worker</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>Multiple Pack</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 2581</span>
<span class="cm"> * PROB: Exact Change Only</span>
<span class="cm"> * ALGO: DP(Multiple Pack)</span>
<span class="cm"> * DATE: Jul 28, 2011 </span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>

<span class="k">const</span> <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">f</span><span class="p">[</span><span class="mi">510</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">zero_one_pack</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">max_value</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">value</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">complete_pack</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">max_value</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">value</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">multiple_pack</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">task</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">amount</span> <span class="o">&gt;=</span> <span class="n">max_value</span><span class="p">)</span>
	<span class="n">complete_pack</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="p">;</span> <span class="n">amount</span> <span class="o">-=</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
	    <span class="n">zero_one_pack</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>

	<span class="n">zero_one_pack</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">amount</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">ta</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">task</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%lf%d%d%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ta</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">;</span> <span class="n">task</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">ta</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">;</span>
        <span class="n">multiple_pack</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
        <span class="n">multiple_pack</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
        <span class="n">multiple_pack</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
        <span class="n">multiple_pack</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">task</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">task</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;NO EXACT CHANGE&quot;</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">now</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">now</span> <span class="o">&amp;&amp;</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">now</span> <span class="o">-</span> <span class="mi">25</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="p">{</span> <span class="n">B</span><span class="o">++</span><span class="p">;</span> <span class="n">now</span> <span class="o">-=</span> <span class="mi">25</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">now</span> <span class="o">&amp;&amp;</span> <span class="n">C</span> <span class="o">&lt;</span> <span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">now</span> <span class="o">-</span> <span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="p">{</span> <span class="n">C</span><span class="o">++</span><span class="p">;</span> <span class="n">now</span> <span class="o">-=</span> <span class="mi">10</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">now</span> <span class="o">&amp;&amp;</span> <span class="n">D</span> <span class="o">&lt;</span> <span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">now</span> <span class="o">-</span>  <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="p">{</span> <span class="n">D</span><span class="o">++</span><span class="p">;</span> <span class="n">now</span> <span class="o">-=</span>  <span class="mi">5</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">now</span> <span class="o">&amp;&amp;</span> <span class="n">E</span> <span class="o">&lt;</span> <span class="n">e</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">now</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">task</span><span class="p">)</span> <span class="p">{</span> <span class="n">E</span><span class="o">++</span><span class="p">;</span> <span class="n">now</span> <span class="o">-=</span>  <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d %d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>RMQ ST</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 3264</span>
<span class="cm"> * PROB: Balanced Lineup</span>
<span class="cm"> * ALGO: RMQ_ST</span>
<span class="cm"> * DATE: Jul 22, 2011</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">50010</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">height</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">mx</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">RMQ_init</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">mx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">mx</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
            <span class="n">mn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">RMQ_max</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// [l, r)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">mx</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">)]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">RMQ_min</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// [l, r)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">)]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">RMQ_init</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">);</span> <span class="c1">// [l, r], starting from 1</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">RMQ_max</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">RMQ_min</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<h2>RMQ ST for Lowest Common Ancestor</h2>
<div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  SRC: POJ 1986</span>
<span class="cm"> * PROB: Distance Queries</span>
<span class="cm"> * ALGO: RMQ-ST-LCA (Lowest Common Ancestor)</span>
<span class="cm"> * DATE: May 28, 2012</span>
<span class="cm"> * COMP: g++</span>
<span class="cm"> *</span>
<span class="cm"> * Created by Leewings Ac</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;cstdio&gt;</span>
<span class="cp">#include &lt;cstring&gt;</span>
<span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;vector&gt;</span>
<span class="cp">#include &lt;algorithm&gt;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Edge</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
    <span class="n">Edge</span><span class="p">(</span><span class="kt">int</span> <span class="n">_v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">_d</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">_v</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">vci</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">edge</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cnt</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">parent</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">dist</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">rev_label</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span> <span class="n">seq</span><span class="p">[</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">mn</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">MAXN</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span><span class="p">;</span>
    <span class="n">label</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">;</span>
    <span class="n">rev_label</span><span class="p">[</span><span class="n">cnt</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
    <span class="n">pos</span><span class="p">[</span><span class="n">label</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
    <span class="n">seq</span><span class="p">[</span><span class="n">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">vci</span> <span class="n">e</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span> <span class="n">e</span> <span class="o">!=</span> <span class="n">edge</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">end</span><span class="p">();</span> <span class="n">e</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">!=</span> <span class="n">parent</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">parent</span><span class="p">[</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">,</span> <span class="n">length</span> <span class="o">+</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">);</span>
            <span class="n">seq</span><span class="p">[</span><span class="n">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">RMQ_init</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">mn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">RMQ_min</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="c1">// [l, r)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">log2</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">mn</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">],</span> <span class="n">mn</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">)]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">RMQ_lca</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">rev_label</span><span class="p">[</span><span class="n">RMQ_min</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%*d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d%d%*s&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">));</span>
        <span class="n">edge</span><span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">parent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">RMQ_init</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
        <span class="n">u</span><span class="o">--</span><span class="p">;</span> <span class="n">v</span><span class="o">--</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist</span><span class="p">[</span><span class="n">RMQ_lca</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</body>
</html>
